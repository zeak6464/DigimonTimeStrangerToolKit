require("include")

function m010_040()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m010")
  LOAD_VOICE()
  SetEventCutNo(7)
  if Debug.IsEventView() then
    SetTimeZone("Noon")
    SetTimeAxis("X2028_daft_10")
    LoadMap("t0107")
  end
  LoadModel("HERO_01", "Player")
  Load_DigiviceHologram()
  LoadSceneViewerResource("c01", "t0107f_cm")
  LoadSceneViewerResource("c02", "t0107f_cm")
  LoadSceneViewerResource("c03", "t0107f_cm")
  LoadSceneViewerResource("c03_A1", "t0107f_cm")
  LoadSceneViewerResource("c03_B1", "t0107f_cm")
  LoadSceneViewerResource("c03_C1", "t0107f_cm")
  LoadSceneViewerResource("c04", "t0107f_cm")
  LoadSceneViewerResource("c05", "t0107f_cm")
  LoadSceneViewerResource("c06", "t0107f_cm")
  LoadSceneViewerResource("c07", "t0107f_cm")
  LoadEnvironmentFile("c01", "es_m010_040_c01")
  LoadEnvironmentFile("c02", "es_m010_040_c02")
  LoadEnvironmentFile("c03", "es_m010_040_c03")
  LoadEnvironmentFile("c03_A1", "es_m010_040_c03_A1")
  LoadEnvironmentFile("c03_B1", "es_m010_040_c03_B1")
  LoadEnvironmentFile("c03_C1", "es_m010_040_c03_C1")
  LoadEnvironmentFile("c04", "es_m010_040_c04")
  LoadEnvironmentFile("c05", "es_m010_040_c05")
  LoadEnvironmentFile("c06", "es_m010_040_c06")
  LoadEnvironmentFile("c07", "es_m010_040_c07")
  WaitVistaLoad()
  Event_StopBGM(2, 0)
  SetPosition("HERO_01", -30.827, 0.055, 54.236, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 180, 0, "LINEAR", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", -30, 0, 0, true, "SCURVE", 0, 0)
  PlayMotion("HERO_01", "fn01_01", 0, true, 0)
  SetFace("HERO_01", "E01_M15", 0, 1, FACE_BLENDTIME, 0)
  SetBlink("HERO_01", 0, 1, 0)
  SetMouth("HERO_01", 1, 0, 0)
  Set_DigiviceHologram()
  SetCamera(-31.852, 0.936, 53.823, 0, 45, "LINEAR", 0, false, 0)
  SetCameraTarget(-23.746, 14.994, 31.239, "LINEAR", 0, false, 0)
  SetCamera(-31.852, 0.936, 53.823, 0, 45, "LINEAR", 300, true, 0)
  SetCameraTarget(-23.746, 7.304, 31.239, "LINEAR", 300, true, 0)
  SetEnv_All("c01", 0)
  FIELD_SET()
  EVENT_START()
  SetMobTransparentRange(0.001, 0.001, 0.001)
  CUT("1.0")
  Fade_In(0, FADE_TIME)
  WaitFrame(FADE_TIME)
  WaitFrame(60)
  local ambient_id = Event_PlaySE(220086, 100, true, 4, 0)
  MovePosition("HERO_01", -30.827, 0.055, 51.906, false, 1, 0)
  MoveRotation("HERO_01", 0, 180, 0, "LINEAR", 1, true, 0)
  MOVE_WAIT("HERO_01")
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 20, 0)
  PlayMotion("HERO_01", "e201", 0, false, 0)
  WaitFrame(100)
  CUT("2.0")
  SetEnv_All("c02", 0)
  SetCamera(-15.526, 0.911, -0.175, 0, 55, "LINEAR", 0, false, 0)
  SetCameraTarget(-25.428, 17.698, -15.399, "LINEAR", 0, false, 0)
  SetCamera(-14.39, 0.911, -0.09, 0, 55, "ACCEL_B", 170, false, 0)
  SetCameraTarget(-6.485, 22.591, -18.246, "ACCEL_B", 170, false, 0)
  WaitFrame(150)
  SetCamera(-13.762, 0.911, 0.112, 0, 55, "DECEL_B", 200, false, 0)
  SetCameraTarget(11.712, 29.6, -24.118, "DECEL_B", 200, false, 0)
  EndMotion("HERO_01", 0)
  WaitFrame(200)
  CUT("3.0")
  SetEnv_All("c03", 0)
  SetCamera(-31.478, 1.528, 51.158, 0, 39, "LINEAR", 0, false, 0)
  SetCameraTarget(-30.781, 1.477, 51.848, "LINEAR", 0, false, 0)
  BlendEye("HERO_01", 20, 5, "SCURVE", 10, 15)
  BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 30, 15)
  local slot_id = Event_PlaySE(500006, 100, true, 0, 0)
  WaitFrame(30)
  Event_StopSE(slot_id, 0.2, 3)
  local slot_id = Event_PlaySE(402002, 100, false, 0, 3)
  Play_DigiviceHologram()
  WaitFrame(30)
  PlayMotion("Horo_AGENT", "e002", 5, true, 0)
  MessageTalk("m010_040_010")
  MessageClose()
  WaitFrame(10)
  correct = false
  while not Vista.IsSkipping() and not correct do
    SetEnv_All("c03", 0)
    SetFace("HERO_01", "E01_M15", 0, 1, FACE_BLENDTIME, 0)
    SetCamera(-31.478, 1.528, 51.158, 0, 39, "LINEAR", 0, false, 0)
    SetCameraTarget(-30.781, 1.477, 51.848, "LINEAR", 0, false, 0)
    Event_StopSE(ambient_id, 0.2, 0)
    Event_PlayBGM(601, 0, 0)
    MessageTalkSel(3, "m010_040_020")
    result = Talk.GetResultSelectedNum()
    CUT("3.0A")
    if result == RESULT_TALK00 then
      WaitFrame(10)
      correct = true
      CUT("3.0B")
    elseif result == RESULT_TALK01 then
      SetEnv_All("c03_B1", 0)
      SetCamera(-34.712, 2.682, -5.828, 0, 20, "LINEAR", 0, false, 0)
      SetCameraTarget(-27.692, 1.536, -0.273, "LINEAR", 0, false, 0)
      SetCamera(-34.712, 2.682, -5.828, 0, 20, "LINEAR", 450, true, 0)
      SetCameraTarget(-28.842, 1.436, -0.273, "LINEAR", 450, true, 0)
      WaitFrame(10)
      MessageTalk("m010_040_030")
      MessageTalk("m010_040_040")
      MessageTalk("m010_040_050")
      MessageClose()
      WaitFrame(10)
      CUT("3.0C")
    elseif result == RESULT_TALK02 then
      SetEnv_All("c03_C1", 0)
      SetCamera(-35, 0.899, 45.879, 0, 55, "LINEAR", 0, false, 0)
      SetCameraTarget(-30.938, 5.358, 34.571, "LINEAR", 0, false, 0)
      SetCamera(-35, 0.899, 45.879, 0, 55, "LINEAR", 450, true, 0)
      SetCameraTarget(-30.108, 5.358, 34.491, "LINEAR", 450, true, 0)
      WaitFrame(10)
      MessageTalk("m010_040_060")
      MessageTalk("m010_040_070")
      MessageTalk("m010_040_080")
      MessageClose()
      WaitFrame(10)
    end
  end
  CUT("4.0")
  SetEnv_All("c04", 0)
  SetCamera(-27.771, 3.462, 15.139, 0, 40, "LINEAR", 0, true, 0)
  SetCameraTarget(-27.322, 3.001, 13.157, "LINEAR", 0, true, 0)
  SetCamera(-28.167, 3.868, 16.886, 0, 40, "LINEAR", 450, true, 0)
  SetCameraTarget(-27.322, 3.001, 13.157, "LINEAR", 450, true, 0)
  WaitFrame(10)
  MessageTalk("m010_040_090")
  MessageTalk("m010_040_100")
  MessageTalk("m010_040_110")
  MessageTalk("m010_040_120")
  MessageClose()
  WaitFrame(10)
  CUT("5.0")
  SetEnv_All("c05", 0)
  SetBlink("HERO_01", 1, 1, 0)
  SetCamera(-31.136, 1.501, 51.382, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-30.804, 1.575, 51.834, "LINEAR", 0, false, 0)
  WaitFrame(10)
  MessageTalk("m010_040_130")
  MessageClose()
  WaitFrame(10)
  BlendEye("HERO_01", 20, 5, "SCURVE", 0, 0)
  SetFace("HERO_01", "E15_M15", 2, 1, 3, 0)
  SetFace("HERO_01", "E15_M04", 1, 1, 6, 4)
  BlendEye("HERO_01", 0, 5, "SCURVE", 0, 1)
  BlendFace("HERO_01", -7, 0, 0, true, "SCURVE", 15, 0)
  WaitFrame(60)
  CUT("6.0")
  SetEnv_All("c06", 0)
  SetCamera(-31.333, 1.771, 52.488, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-30.931, 1.558, 51.882, "LINEAR", 0, false, 0)
  BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 0, 0)
  WaitFrame(10)
  PlayMotion("Horo_AGENT", "e021_01", 5, false, 0)
  MessageTalk("m010_040_140")
  MessageTalk("m010_040_150")
  MessageClose()
  WaitFrame(10)
  PlayMotion("Horo_AGENT", "e002", 5, true, 15)
  MessageTalk("m010_040_160")
  MessageClose()
  PlayMotionBlend("HERO_01", "blend01", 0, false, 0)
  SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
  WaitFrame(30)
  Close_DigiviceHologram()
  CUT("7.0")
  SetEnv_All("c07", 0)
  SetBlink("HERO_01", 0, 1, 0)
  if Debug.IsEventView() then
    Event_StopBGM(2, 0)
    Event_StopAllSE(0, 0)
    EVENT_END()
  else
    Event_StopBGM(2, 0)
    EVENT_END_SEAMLESS(60)
    WaitFrame(45)
  end
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m010_040()
end
