S030_029 = {
  ID = 29,
  STEP_001 = 1,
  STEP_003 = 3,
  STEP_005 = 5,
  STEP_007 = 7,
  STEP_010 = 10,
  STEP_020 = 20,
  STEP_255 = 255
}
local base = "s030_029_"
local text_file = "s030_029"

function S030_029:Event_010()
  local b_index = GetIndex(NPC, "bacchus_01")
  local bacchus = Obj:new(NPC, "bacchus_01")
  local b_e100 = Motion.Object:new(NPC, "bacchus_01", "e100")
  local b_e114 = Motion.Object:new(NPC, "bacchus_01", "e114")
  local b_e115 = Motion.Object:new(NPC, "bacchus_01", "e115")
  local k_index = GetIndex(NPC, "sub029_001")
  local k_bn01 = Motion.Object:new(NPC, "sub029_001", "bn01")
  local k_fq01 = Motion.Object:new(NPC, "sub029_001", "fq01")
  local k_fq02 = Motion.Object:new(NPC, "sub029_001", "fq02")
  local d_index = GetIndex(NPC, "sub029_003")
  local duft = Obj:new(NPC, "sub029_003")
  local d_bn01 = Motion.Object:new(NPC, "sub029_003", "bn01")
  local d_fq01 = Motion.Object:new(NPC, "sub029_003", "fq01")
  local d_fq02 = Motion.Object:new(NPC, "sub029_003", "fq02")
  local p_e002 = Motion.Object:new(PLAYER, "", "e002")
  local p_e004 = Motion.Object:new(PLAYER, "", "e004")
  local p_e012 = Motion.Object:new(PLAYER, "", "e012")
  local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
  HideMinimap(true)
  HideGuide(true)
  if Qst.Sub:Check(self.ID, self.STEP_003, self.STEP_005) then
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Obj:new(PLAYER, ""):SetPos(0.45, 0, -9.948)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    local tlk = Tlk:new(text_file, 1, true)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Cam.Inst:Set(4.428, 2.708, -14.89, -1.777, 1.332, -7.179, default, 0)
    WaitFrame(30)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, b_index, 0)
    Field.ObjectLookAtTheObject(NPC, d_index, PLAYER, 1, 0)
    Field.ObjectLookAtTheObject(NPC, k_index, PLAYER, 1, 0)
    p_fn01_01:Play(15, true)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    b_e115:Play(15, true)
    tlk:Message(base .. "150")
    tlk:MessageClose()
    b_e100:Play(15, true)
    local result2 = tlk:Select(2, base .. "160")
    if result2 == RESULT_TALK00 then
      WaitFrame(15)
      tlk:Message(base .. "120")
    elseif result2 == RESULT_TALK01 then
      WaitFrame(15)
      tlk:Message(base .. "140")
      tlk:EndTalk()
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      Cam.Inst:Clear(0)
      WaitFrame(30)
      HideMinimap(false)
      HideGuide(false)
      FieldObjectSync(FOR_ALL, false)
      FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
      Qst.Sub:Set(self.ID, self.STEP_003)
      goto lbl_948
    end
    PlayerObjectResetAim()
    Obj:new(NPC, "sub029_003"):SetRotationYToObject(PLAYER, "", 20)
    d_fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "190")
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, d_index, 30)
    tlk:MessageClose()
    d_fq02:PlayWithStartMoveMotion(10, 10)
    local result3 = tlk:Select(3, base .. "200")
    if result3 == RESULT_TALK00 then
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      tlk:Message(base .. "210")
    elseif result3 == RESULT_TALK01 then
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      d_fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "220")
    else
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      d_fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "230")
    end
    duft:ChangeExpression("F01_T01", EYE_BLINK, true, 10)
    Qst.Sub:Set(self.ID, self.STEP_003)
    Qst.Sub:Set(self.ID, self.STEP_005)
    Flg.Set("FLAG_SUB_030_029_001")
    tlk:EndTalk()
    Qst.Sub:Start(self.ID, 1, false)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Cam.Inst:Clear(0)
    WaitFrame(30)
    HideMinimap(false)
    HideGuide(false)
    FieldObjectSync(FOR_ALL, false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
  elseif Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Obj:new(PLAYER, ""):SetPos(0.45, 0, -9.948)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    local tlk = Tlk:new(text_file, 1, true)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Cam.Inst:Set(4.428, 2.708, -14.89, -1.777, 1.332, -7.179, default, 0)
    WaitFrame(30)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, b_index, 0)
    Field.ObjectLookAtTheObject(NPC, d_index, PLAYER, 1, 0)
    Field.ObjectLookAtTheObject(NPC, k_index, PLAYER, 1, 0)
    p_fn01_01:Play(15, true)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    b_e114:Play(15, true)
    tlk:Message(base .. "013")
    tlk:Message(base .. "016")
    b_e100:Play(15, true)
    k_fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "020")
    b_e115:Play(15, true)
    tlk:Message(base .. "030")
    tlk:Message(base .. "040")
    b_e100:Play(15, true)
    tlk:MessageClose()
    local result = tlk:Select(3, base .. "050")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      b_e115:Play(15, true)
      tlk:Message(base .. "060")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      b_e114:Play(15, true)
      tlk:Message(base .. "070")
    else
      WaitFrame(15)
      b_e114:Play(15, true)
      tlk:Message(base .. "080")
    end
    b_e100:Play(15, true)
    k_fq02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "090")
    b_e115:Play(15, true)
    tlk:Message(base .. "100")
    b_e100:Play(15, true)
    tlk:MessageClose()
    local result1 = tlk:Select(3, base .. "110")
    if result1 == RESULT_TALK00 then
      WaitFrame(15)
      tlk:Message(base .. "120")
    elseif result1 == RESULT_TALK01 then
      WaitFrame(15)
      b_e115:Play(15, true)
      tlk:Message(base .. "130")
      b_e100:Play(10, true)
    else
      WaitFrame(15)
      tlk:Message(base .. "140")
      tlk:EndTalk()
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      Cam.Inst:Clear(0)
      WaitFrame(10)
      FieldObjectSync(FOR_ALL, false)
      WaitFrame(15)
      HideMinimap(false)
      HideGuide(false)
      FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
      Qst.Sub:Set(self.ID, self.STEP_003)
      goto lbl_948
    end
    PlayerObjectResetAim()
    Obj:new(NPC, "sub029_003"):SetRotationYToObject(PLAYER, "", 20)
    d_fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "190")
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, d_index, 30)
    tlk:MessageClose()
    d_fq02:PlayWithStartMoveMotion(10, 10)
    local result3 = tlk:Select(3, base .. "200")
    if result3 == RESULT_TALK00 then
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      tlk:Message(base .. "210")
    elseif result3 == RESULT_TALK01 then
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      d_fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "220")
    else
      WaitFrame(15)
      duft:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      d_fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "230")
    end
    duft:ChangeExpression("F01_T01", EYE_BLINK, true, 10)
    Qst.Sub:Set(self.ID, self.STEP_003)
    Qst.Sub:Set(self.ID, self.STEP_005)
    Flg.Set("FLAG_SUB_030_029_001")
    tlk:EndTalk()
    Qst.Sub:Start(self.ID, 1, false)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    b_e100:Play(10, true)
    Cam.Inst:Clear(0)
    WaitFrame(10)
    FieldObjectSync(FOR_ALL, false)
    WaitFrame(15)
    HideMinimap(false)
    HideGuide(false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
  elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "100")
    tlk:Message(base .. "120")
    HideMinimap(false)
    HideGuide(false)
    tlk:EndTalk()
  end
  ::lbl_948::
end

function S030_029:Event_020()
  local t_bn01 = Motion.Object:new(NPC, "sub029_001", "bn01")
  local t_fq02 = Motion.Object:new(NPC, "sub029_001", "fq02")
  local t_fe02 = Motion.Object:new(NPC, "sub029_001", "fe02")
  local d_bn01 = Motion.Object:new(NPC, "sub029_002", "bn01")
  local d_fe02 = Motion.Object:new(NPC, "sub029_002", "fe02")
  local d_fe04 = Motion.Object:new(NPC, "sub029_002", "fe04")
  local d_fq01 = Motion.Object:new(NPC, "sub029_002", "fq01")
  local d_fq02 = Motion.Object:new(NPC, "sub029_002", "fq02")
  local g_fe02 = Motion.Object:new(NPC, "sub029_003", "fe02")
  local p_e002 = Motion.Object:new(PLAYER, "", "e002")
  local p_e004 = Motion.Object:new(PLAYER, "", "e004")
  local p_e012 = Motion.Object:new(PLAYER, "", "e012")
  local p_e018 = Motion.Object:new(PLAYER, "", "e018")
  local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
  p_fn01_01:Play(15, true)
  HideMinimap(true)
  HideGuide(true)
  Field_InvisibleFollowerAllGuest(0, 0, false)
  if Qst.Sub:Check(self.ID, self.STEP_007, self.STEP_010) then
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Obj:new(PLAYER, ""):SetPos(14.24, 0, 24.538)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    local tlk = Tlk:new(text_file, 1, true)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Cam.Inst:Set(14.7326, 2.7014, 20.7475, 10.5433, 1.635, 29.765, default, 0)
    p_fn01_01:Play(15, true)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    d_fe04:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "290")
    tlk:MessageClose()
    local result1 = tlk:Select(3, base .. "300")
    if result1 == RESULT_TALK00 then
      WaitFrame(15)
      d_fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "310")
    elseif result1 == RESULT_TALK01 then
      WaitFrame(15)
      d_fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "320")
    else
      WaitFrame(15)
      d_fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "330")
      tlk:EndTalk()
      Cam.Inst:Clear(30)
      WaitFrame(30)
      Qst.Sub:Set(self.ID, self.STEP_007)
      goto lbl_527
    end
    tlk:EndTalk(true)
    Guest.Add(27392)
    WaitFrame(1)
    p_e018:Play(10, false)
    g_fe02:Play(15, false)
    Qst.Sub:Set(self.ID, self.STEP_007)
    Qst.Sub:Set(self.ID, self.STEP_010)
    EncountFromField_WithNormalEffect(20300290, BTL_MAP_BACCHUS_SANCTUARY, false)
  elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Obj:new(PLAYER, ""):SetPos(14.24, 0, 24.538)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    local tlk = Tlk:new(text_file, 1, true)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Cam.Inst:Set(14.7326, 2.7014, 20.7475, 10.5433, 1.635, 29.765, default, 0)
    p_fn01_01:Play(15, true)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    t_fq02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "240")
    tlk:MessageClose()
    local result = tlk:Select(3, base .. "250")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      t_fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "260")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      t_fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "270")
    else
      WaitFrame(15)
      t_fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "280")
    end
    d_fe04:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "290")
    tlk:MessageClose()
    local result1 = tlk:Select(3, base .. "300")
    if result1 == RESULT_TALK00 then
      WaitFrame(15)
      d_fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "310")
    elseif result1 == RESULT_TALK01 then
      WaitFrame(15)
      d_fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "320")
    else
      WaitFrame(15)
      d_fq02:PlayWithStartMoveMotion(10, 10)
      tlk:EndTalk()
      Cam.Inst:Clear(30)
      WaitFrame(30)
      Qst.Sub:Set(self.ID, self.STEP_007)
      goto lbl_527
    end
    tlk:EndTalk(true)
    Guest.Add(27392)
    WaitFrame(1)
    p_e018:Play(10, false)
    g_fe02:Play(15, false)
    Qst.Sub:Set(self.ID, self.STEP_007)
    Qst.Sub:Set(self.ID, self.STEP_010)
    EncountFromField_WithNormalEffect(20300290, BTL_MAP_BACCHUS_SANCTUARY, false)
  end
  ::lbl_527::
end

function S030_029:Event_030()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_020) and Flg.Check("FLAG_SUB_030_029_010") then
    HideMinimap(true)
    HideGuide(true)
    local tono = Obj:new(NPC, "sub029_001")
    local t_index = GetIndex(NPC, "sub029_001")
    local t_bn01 = Motion.Object:new(NPC, "sub029_001", "bn01")
    local t_fe02 = Motion.Object:new(NPC, "sub029_001", "fe02")
    local d_index = GetIndex(NPC, "sub029_002")
    local d_bn01 = Motion.Object:new(NPC, "sub029_002", "bn01")
    local d_fe02 = Motion.Object:new(NPC, "sub029_002", "fe02")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    local tlk = Tlk:new(text_file, 1, true)
    FieldObjectSync(FOR_ALL, false)
    p_fn01_01:Play(15, true)
    tlk:StartTalkAndCancelDigimonRide()
    Cam.Inst:Set(18.043, 2.951, 19.562, 15.013, 1.0623, 28.9026, default, 0)
    Obj:new(PLAYER, ""):SetPos(16.235, 0, 25.06)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    Obj:new(NPC, "sub029_001"):SetRotationY(180, 0)
    Obj:new(NPC, "sub029_002"):SetRotationY(210, 0)
    WaitFrame(30)
    Field.ObjectLookAtTheObject(NPC, d_index, PLAYER, 1, 0)
    Field.ObjectLookAtTheObject(NPC, t_index, PLAYER, 1, 0)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, t_index, 0)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    d_fe02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "350")
    tlk:Message(base .. "355")
    tono:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
    t_fe02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "360")
    tlk:EndTalk(true)
    Guest.Delete(27392)
    Qst.Sub:Set(self.ID, self.STEP_020)
    Flg.Set("FLAG_SUB_030_029_003")
    MapChange("d", 404, "start_00", true, FADE_BLACK, FADE_TIME)
  end
end

function S030_029:Event_040()
  if Qst.Sub:Check(self.ID, self.STEP_020, self.STEP_255) then
    local b_index = GetIndex(NPC, "bacchus_01")
    local b_e100 = Motion.Object:new(NPC, "bacchus_01", "e100")
    local b_e114 = Motion.Object:new(NPC, "bacchus_01", "e114")
    local b_e115 = Motion.Object:new(NPC, "bacchus_01", "e115")
    local d_bn01 = Motion.Object:new(NPC, "sub029_007", "bn01")
    local d_fq01 = Motion.Object:new(NPC, "sub029_007", "fq01")
    local d_fe02 = Motion.Object:new(NPC, "sub029_007", "fe02")
    local p_e002 = Motion.Object:new(PLAYER, "", "e002")
    local p_e004 = Motion.Object:new(PLAYER, "", "e004")
    local p_e012 = Motion.Object:new(PLAYER, "", "e012")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, b_index, 0)
    Flg.Set("FLAG_SKIP_AREACHANGE_MOVE")
    SetFollowerCameraOperateRotation(0, 0)
    Cam.Inst:Set(2.114, 1.6, -11.06, 2.56, 1.498, -1.07, default, 0)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Obj:new(PLAYER, ""):SetPos(1.14, 0, -9)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    p_fn01_01:Play(15, true)
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    b_e114:Play(15, true)
    tlk:Message(base .. "370")
    tlk:Message(base .. "380")
    tlk:Message(base .. "390")
    tlk:Message(base .. "400")
    b_e115:Play(15, true)
    tlk:Message(base .. "410")
    b_e100:Play(15, true)
    local result = tlk:Select(3, base .. "420")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      b_e114:Play(15, true)
      tlk:Message(base .. "430")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      b_e115:Play(15, true)
      tlk:Message(base .. "440")
    else
      WaitFrame(15)
      b_e115:Play(15, true)
      tlk:Message(base .. "450")
    end
    tlk:Message(base .. "460")
    Flg.Set("FLAG_IS_CLEAR_S030_029")
    Cam.Inst:Set(-1.88, 1.5, -13, 0.39, 1.87, -3.27, default, 30)
    Field.ObjectLookAtTheObject(FLD_OBJ_PLAYER, 1, NPC, GetIndex(NPC, "sub029_007"), 10, 10)
    d_fe02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "470")
    tlk:MessageClose()
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    b_e100:Play(10, true)
    FieldObjectSync(FOR_ALL, false)
    Cam.Inst:Clear(0)
    PlayerObjectResetAim()
    tlk:EndTalk()
    WaitFrame(25)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:End(self.ID, self.STEP_255)
    require("S100_087")
    Flg.Set(S100_087.Flgs.Flg09)
    S100_087.AddReturnRoyalKnightsNum()
    S100_087:Event_020()
  end
end
