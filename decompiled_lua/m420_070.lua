require("include")

function m420_070()
  Fade_Out(1, 0)
  EVENT_BEGIN()
  Talk.Load("m420")
  SetEventCutNo("3")
  if Debug.IsEventView() then
    SetTimeZone("Noon")
    SetTimeAxis("P2028_daft_420")
    LoadMap("t0403")
  end
  Vista.LoadMovieToTV("tvmovie_f", "m420070movie01f")
  Vista.LoadMovieToTV("tvmovie_m", "m420070movie01m")
  local Movie = MOVIE.new("movie", "m420070movie02")
  Load_DigiviceHologram()
  LoadSceneViewerResource("c1.0", "t0403f_ca")
  LoadSceneViewerResource("c2.0", "t0403f_ca")
  LoadEnvironmentFile("c1.0", "es_m420_070_c1.0")
  LoadEnvironmentFile("c2.0", "es_m420_070_c2.0")
  WaitVistaLoad()
  local gender = GetGender()
  if gender == HERO then
    Vista.PlayMovieToTV("tvmovie_m", true)
  elseif gender == HEROINE then
    Vista.PlayMovieToTV("tvmovie_f", true)
  end
  Sound.StopAmbientSE(0)
  SetCamera(1.519, 1.285, -2.235, 0, 40, "LINEAR", 0, false, 0, false)
  SetCameraTarget(0.703, 1.016, -4.167, "LINEAR", 0, false, 0, false)
  SetCamera(1.962, 1.431, -1.186, 0, 40, "SCURVE", 600, true, 0, false)
  SetCameraTarget(0.703, 1.016, -4.167, "SCURVE", 600, true, 0, false)
  SetEnv_All("c1.0", 0)
  FIELD_SET()
  EVENT_START()
  CUT("1.0")
  Fade_In(1, FADE_TIME)
  WaitFrame(FADE_TIME)
  MessageTalk("m420_070_010")
  MessageClose()
  WaitFrame(10)
  CUT("2.0")
  SetEnv_All("c2.0", 0)
  SetCamera(0.592, 1.243, -2.192, 0, 25, "LINEAR", 0, false, 0)
  SetCameraTarget(0.567, 1.079, -4.229, "LINEAR", 0, false, 0)
  CameraOffsetMove(0, 0, -0.1, "LINEAR", true, true, 300, 0)
  WaitFrame(10)
  MessageTalk("m420_070_020")
  MessageClose()
  Fade_OutNoLoadingWithWait(0, 30)
  WaitFrame(15)
  CUT("3.0")
  Fade_In(0, FADE_TIME)
  Vista.SetMessageTalkAuto("m420_070_030", -1, true, 15)
  Vista.SetMessageTalkAuto("m420_070_040", -1, true, 144)
  Vista.SetMessageTalkAuto("m420_070_050", -1, true, 448)
  Movie:PLAY(640)
  MessageClose()
  Fade_OutNoLoadingWithWait(1, 60)
  WaitFrame(30)
  Vista.SetKeepBGM()
  Vista.SetKeepBGMWithMapChange()
  EVENT_END(1)
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m420_070()
end
