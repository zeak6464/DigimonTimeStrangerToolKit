require("include")

function arena_m310_03()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("arena01")
  SetEventCutNo(5)
  if Debug.IsEventView() then
    SetTimeZone("Noon")
    SetTimeAxis("P2028_daft_320")
    SetMapStatus("Enable")
    LoadMap("t0173")
  end
  LoadModel("AEGIOMON_01", "char_AEGIOMON")
  LoadModel("HERO_01", "Player")
  LoadModel("HEROINE_01", "char_HEROINE")
  LoadModel("enemy_01", "char_YATAGARAMON")
  LoadModel("enemy_02", "char_TAOMON")
  LoadModel("referee_01", "char_ETEMON")
  LoadSceneViewerResource("c1.0", "t0173b_ca")
  LoadSceneViewerResource("c2.0", "t0173b_ca")
  LoadSceneViewerResource("c3.0", "t0173b_ca")
  LoadSceneViewerResource("c4.0", "t0173b_ca")
  LoadEnvironmentFile("c1.0", "es_m310_030_c1.0")
  LoadEnvironmentFile("c2.0", "es_m310_030_c1.0")
  LoadEnvironmentFile("c3.0", "es_m310_030_c1.0")
  LoadEnvironmentFile("c4.0", "es_m310_030_c1.0")
  WaitVistaLoad()
  Event_PlayBGM(313, 0, 0)
  local slot_id = Event_PlaySE(405004, 100, true, 0, 0)
  ModelVisible("HERO_01", false, 0, 0)
  ModelVisible("AEGIOMON_01", false, 0, 0)
  ModelVisible("HEROINE_01", false, 0, 0)
  ModelVisible("enemy_01", false, 0, 0)
  ModelVisible("enemy_02", false, 0, 0)
  SetPosition("AEGIOMON_01", 6, 0, -0.494, "LINEAR", 0, 0)
  SetRotation("AEGIOMON_01", 0, -90, 0, "LINEAR", 0, 0)
  SetPosition("HERO_01", 6, 0, 0.833, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -90, 0, "LINEAR", 0, 0)
  SetPosition("HEROINE_01", 6.978, 0, 0.19, "LINEAR", 0, 0)
  SetRotation("HEROINE_01", 0, -90, 0, "LINEAR", 0, 0)
  SetPosition("enemy_01", -8.688, 0, -1.971, "LINEAR", 0, 0)
  SetRotation("enemy_01", 0, 90, 0, "LINEAR", 0, 0)
  SetPosition("enemy_02", -6.785, 0, 0.529, "LINEAR", 0, 0)
  SetRotation("enemy_02", 0, 90, 0, "LINEAR", 0, 0)
  PlayMotion("AEGIOMON_01", "bn01", 0, true, 0)
  SetFace("AEGIOMON_01", "E03_M14", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("HERO_01", "bn01", 0, true, 0)
  SetFace("HERO_01", "E03_M15", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("HEROINE_01", "e005_01", 0, true, 0)
  SetFace("HEROINE_01", "F04", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("enemy_01", "bn01", 0, true, 0)
  SetFace("enemy_01", "F03", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("enemy_02", "bn01", 0, true, 0)
  SetFace("enemy_02", "F03", 0, 1, FACE_BLENDTIME, 0)
  SetPosition("referee_01", -3.271, 0, 0.69, "LINEAR", 0, 0)
  SetRotation("referee_01", 0, 90, 0, "LINEAR", 0, 0)
  PlayMotion("referee_01", "f000", 0, true, 0)
  SetFace("referee_01", "F01", 0, 1, FACE_BLENDTIME, 0)
  BlendEye("AEGIOMON_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("AEGIOMON_01", 0, 0, 0, false, "SCURVE", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
  BlendEye("HEROINE_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HEROINE_01", 0, 0, 0, false, "SCURVE", 0, 0)
  BlendFaceDigi("enemy_01", 0, 0, 0, "SCURVE", 0, 0)
  BlendFaceDigi("enemy_02", 0, 0, 0, "SCURVE", 0, 0)
  SetCamera(-33.719, 20.895, -4.736, -10, 30, "LINEAR", 0, false, 0, false)
  SetCameraTarget(9.201, 14.993, 0.471, "LINEAR", 0, false, 0, false)
  SetCamera(-19.382, 5.118, 24.855, -10, 30, "SCURVE", 180, true, 0, false)
  SetCameraTarget(4.609, 15.63, -4.998, "SCURVE", 180, true, 0, false)
  SetCamera(-15.081, 0.385, 33.732, -10, 30, "DECEL", 200, true, 175, false)
  SetCameraTarget(3.231, 15.821, -6.639, "DECEL", 200, true, 175, false)
  FIELD_SET()
  EVENT_START()
  CUT("1.0")
  SetEnv_All("c1.0", 0)
  Fade_In(FADE_BLACK, FADE_TIME)
  WaitFrame(30)
  MessageTalk("arena01_m310_030_010")
  MessageClose()
  WaitFrame(10)
  CUT("2.0")
  SetEnv_All("c3.0", 0)
  ModelVisible("HERO_01", true, 0, 0)
  if Debug.IsEventView() then
    ModelVisible("AEGIOMON_01", true, 0, 0)
  else
    local aegio = Field.GetFollowerIndexForAegiomon()
    if aegio ~= nil then
      ModelVisible("AEGIOMON_01", true, 0, 0)
    end
    Field_CancelInvisibleFollowerAllPartyMember(INVISIBLE_KEY_EVENT, 0, false, true)
    WaitFrame(1)
    Field.FollowerWarp()
    WaitFrame(1)
    local index = Digimon.GetUniqueIDInPartyMember(1)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, -1.14, 0.01, 8.99, false)
    end
    local index = Digimon.GetUniqueIDInPartyMember(2)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, -3.62, 0.01, 7.81, false)
    end
    local index = Digimon.GetUniqueIDInPartyMember(3)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, -3.91, 0.01, 5.6, false)
    end
  end
  SetPosition("AEGIOMON_01", 0.526, -0.118, 5.564, "LINEAR", 0, 0)
  SetRotation("AEGIOMON_01", 0, 180, 0, "LINEAR", 0, 0)
  SetPosition("HERO_01", -0.206, 0, 6.965, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 180, 0, "LINEAR", 0, 0)
  SetPosition("HEROINE_01", -0.189, 0, 12.627, "LINEAR", 0, 0)
  SetRotation("HEROINE_01", 0, 180, 0, "LINEAR", 0, 0)
  PlayMotion("AEGIOMON_01", "bn01", 0, true, 0)
  SetFace("AEGIOMON_01", "E03_M14", 0, 1, 0, 0)
  PlayMotion("HERO_01", "bn01", 0, true, 0)
  SetFace("HERO_01", "E03_M15", 0, 1, 0, 0)
  SetFace("HEROINE_01", "E03_M15", 0, 1, 0, 0)
  SetCamera(5.047, 0.112, 9.323, 0, 18, "LINEAR", 0, false, 0, false)
  SetCameraTarget(-0.654, 1.444, 5.876, "LINEAR", 0, false, 0, false)
  SetCamera(5.982, 0, 1.837, 0, 18, "SCURVE", 60, false, 0, false)
  SetCameraTarget(-0.6, 1.498, 5.702, "SCURVE", 60, false, 0, false)
  SetCamera(5.6, 0, -0.456, 0, 18, "LINEAR", 150, true, 60, false)
  SetCameraTarget(-0.57, 1.466, 5.503, "LINEAR", 150, true, 60, false)
  WaitFrame(10)
  MessageTalk("arena01_m310_030_020")
  MessageClose()
  WaitFrame(10)
  CUT("3.0")
  SetEnv_All("c2.0", 0)
  ModelVisible("enemy_01", true, 0, 0)
  ModelVisible("enemy_02", true, 0, 0)
  SetPosition("enemy_01", 1.39, 0, -9.018, "LINEAR", 0, 0)
  SetRotation("enemy_01", 0, 0, 0, "LINEAR", 0, 0)
  SetPosition("enemy_02", -0.529, 0, -6.295, "LINEAR", 0, 0)
  SetRotation("enemy_02", 0, 11.5, 0, "LINEAR", 0, 0)
  SetCamera(8.851, 1.01, -16.375, 0, 18, "LINEAR", 0, false, 0, false)
  SetCameraTarget(-0.507, 2.535, -6.701, "LINEAR", 0, false, 0, false)
  SetCamera(10.591, 1.01, -4.505, 0, 18, "SCURVE", 60, false, 0, false)
  SetCameraTarget(-0.507, 2.535, -7.771, "SCURVE", 60, false, 0, false)
  SetCamera(10.891, 1.01, -1.265, 0, 18, "LINEAR", 150, true, 60, false)
  SetCameraTarget(-0.507, 2.535, -7.821, "LINEAR", 150, true, 60, false)
  WaitFrame(10)
  MessageTalk("arena01_m310_030_030")
  MessageClose()
  WaitFrame(10)
  CUT("4.0")
  SetEnv_All("c2.0", 0)
  ModelVisible("enemy_01", true, 0, 0)
  ModelVisible("enemy_02", true, 0, 0)
  SetPosition("enemy_01", 1.09, 0, -8.518, "LINEAR", 0, 0)
  SetRotation("enemy_01", 0, 0, 0, "LINEAR", 0, 0)
  SetPosition("enemy_02", -0.56, 0, -6.295, "LINEAR", 0, 0)
  SetRotation("enemy_02", 0, 11.5, 0, "LINEAR", 0, 0)
  SetCamera(0, 1.369, -2.712, 0, 45, "LINEAR", 0, true, 0, false)
  SetCameraTarget(0, 3.403, -12.247, "LINEAR", 0, true, 0, false)
  WaitFrame(10)
  PlayMotion("enemy_01", "fe02", 10, false, 0)
  PlayMotion("enemy_01", "bn01", 10, true, 68)
  WaitFrame(60)
  PlayMotion("enemy_02", "fe04", 10, false, 0)
  PlayMotion("enemy_02", "bn01", 10, true, 60)
  WaitFrame(10)
  SetFace("enemy_02", "F03", 0, 1, FACE_BLENDTIME, 0)
  MessageTalk("arena01_m310_030_040")
  SetFace("enemy_02", "F03", 0, 1, FACE_BLENDTIME, 0)
  MessageClose()
  WaitFrame(20)
  CUT("5.0")
  SetEnv_All("c4.0", 0)
  if Debug.IsEventView() then
    ModelVisible("HEROINE_01", true, 0, 0)
  else
    local heroine = Field.GetFollowerIndexByGuestID(GST_HEROINE)
    if heroine ~= nil then
      ModelVisible("HEROINE_01", true, 0, 0)
    end
    Field_CancelInvisibleFollowerAllPartyMember(INVISIBLE_KEY_EVENT, 0, false, true)
    local index = Digimon.GetUniqueIDInPartyMember(1)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, -2.14, 0, 8.99, false)
    end
    local index = Digimon.GetUniqueIDInPartyMember(2)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, -0.0799, 0, 9.95, false)
    end
    local index = Digimon.GetUniqueIDInPartyMember(3)
    if index ~= nil then
      local party = Field.GetFollowerIndexByPartyUniqueID(index)
      Field.ObjectSetRotationY(FLD_OBJ_FOLLOWER, party, 0, 0)
      Field.ObjectSetPos(FLD_OBJ_FOLLOWER, party, 2, 0, 9.29, false)
    end
  end
  SetPosition("AEGIOMON_01", 1.83, 0, 5.893, "LINEAR", 0, 0)
  SetRotation("AEGIOMON_01", 0, 180, 0, "LINEAR", 0, 0)
  SetPosition("HERO_01", 0.057, 0, 7.266, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 151.5, 0, "LINEAR", 0, 0)
  SetPosition("HEROINE_01", 0, 0, 11.343, "LINEAR", 0, 0)
  SetRotation("HEROINE_01", 0, 161, 0, "LINEAR", 0, 0)
  SetPosition("enemy_01", 2.5, 0, -7.019, "LINEAR", 0, 0)
  SetRotation("enemy_01", 0, 2.5, 0, "LINEAR", 0, 0)
  SetPosition("enemy_02", 0, 0, -4.685, "LINEAR", 0, 0)
  SetRotation("enemy_02", 0, 2.5, 0, "LINEAR", 0, 0)
  BlendEye("HEROINE_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HEROINE_01", -38, 0, 0, false, "SCURVE", 0, 0)
  SetCamera(-6.565, 5.8, 0, 0, 20, "LINEAR", 0, false, 0, false)
  SetCameraTarget(-37.683, 11.105, 0, "LINEAR", 0, false, 0, false)
  SetCamera(30.731, 1.712, 0, 0, 33, "DECEL", 10, false, 0, false)
  SetCameraTarget(0, 5.361, 0, "DECEL", 10, false, 0, false)
  SetCamera(32.268, 1.53, 0, 0, 33, "LINEAR", 150, true, 10, false)
  SetCameraTarget(0, 5.361, 0, "LINEAR", 150, true, 10, false)
  MessageTalk("arena01_m310_030_050")
  MessageClose()
  WaitFrame(15)
  Fade_OutNoLoadingWithWait(1, 2)
  PlaySE(101006, 100)
  WaitFrame(20)
  Event_StopAllSE(0.2, 0)
  if Debug.IsEventView() then
  end
  EVENT_END()
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  arena_m310_03()
end
