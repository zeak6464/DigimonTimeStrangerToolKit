require("include")

function m070_040()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m070")
  SetEventCutNo(11)
  if Debug.IsEventView() then
    SetTimeZone("Noon")
    SetTimeAxis("A2020_dbef_70")
    LoadMap("t0302")
  end
  LoadModel("HERO_01", "Player")
  LoadModel("KUREMI_01", "char_KUREMI")
  LoadModel("TAKEMIYA_01", "char_TAKEMIYA")
  LoadModel("AEGIOMON_B_01", "char_AEGIOMON_PLAIN_CLOTHES")
  Vista.BindSpeaker("AEGIOMON_B_01", "char_AEGIOMON")
  LoadModel("SIMONS_01", "char_SIMMONS")
  LoadModel("npc006aa010101_01", "char_SUMERAGI")
  LoadSceneViewerResource("c1.0", "t0302f_pa")
  LoadSceneViewerResource("c2.0", "t0302f_pa")
  LoadSceneViewerResource("c3.0", "t0302f_pa")
  LoadSceneViewerResource("c4.0", "t0302f_pa")
  LoadSceneViewerResource("c5.0", "t0302f_pa")
  LoadSceneViewerResource("c6.0", "t0302f_pa")
  LoadSceneViewerResource("c7.0", "t0302f_pa")
  LoadSceneViewerResource("7.0_A1", "t0302f_pa")
  LoadSceneViewerResource("7.0_B1", "t0302f_pa")
  LoadSceneViewerResource("7.0_C1", "t0302f_pa")
  LoadSceneViewerResource("c8.0", "t0302f_pa")
  LoadEnvironmentFile("c1.0", "es_m070_040_c1.0")
  LoadEnvironmentFile("c2.0", "es_m070_040_c2.0")
  LoadEnvironmentFile("c3.0", "es_m070_040_c3.0")
  LoadEnvironmentFile("c4.0", "es_m070_040_c4.0")
  LoadEnvironmentFile("c5.0", "es_m070_040_c5.0")
  LoadEnvironmentFile("c6.0", "es_m070_040_c6.0")
  LoadEnvironmentFile("c7.0", "es_m070_040_c7.0")
  LoadEnvironmentFile("7.0_A1", "es_m070_040_c7.0_A1")
  LoadEnvironmentFile("7.0_B1", "es_m070_040_c7.0_B1")
  LoadEnvironmentFile("7.0_C1", "es_m070_040_c7.0_C1")
  LoadEnvironmentFile("c8.0", "es_m070_040_c8.0")
  WaitVistaLoad()
  SetPosition("HERO_01", 0.604, -0, 3.131, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -73.59, 0, "LINEAR", 0, 0)
  SetPosition("KUREMI_01", -0.337, 0, 1.583, "LINEAR", 0, 0)
  SetRotation("KUREMI_01", 0, -6, 0, "LINEAR", 0, 0)
  SetPosition("TAKEMIYA_01", -1.354, 0, 2.976, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, 126.5, 0, "LINEAR", 0, 0)
  SetPosition("AEGIOMON_B_01", 0.202, 0, 3.655, "LINEAR", 0, 0)
  SetRotation("AEGIOMON_B_01", 0, 214.5, 0, "LINEAR", 0, 0)
  SetPosition("SIMONS_01", -1.912, 0, 0.837, "LINEAR", 0, 0)
  SetRotation("SIMONS_01", 0, 33.569, 0, "LINEAR", 0, 0)
  SetPosition("npc006aa010101_01", -2.893, 0, -4.549, "LINEAR", 0, 0)
  SetRotation("npc006aa010101_01", 0, 0, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "fn01_01", 0, true, 0)
  SetFace("HERO_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("KUREMI_01", "e012", 0, true, 0)
  SetStartFrame("KUREMI_01", "e012", 30, 0)
  SetFace("KUREMI_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("TAKEMIYA_01", "fn01_01", 0, true, 0)
  SetFace("TAKEMIYA_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("AEGIOMON_B_01", "fn01_01", 0, true, 0)
  SetFace("AEGIOMON_B_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("SIMONS_01", "fn01_01", 0, true, 0)
  SetFace("SIMONS_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("npc006aa010101_01", "fn01_01", 0, false, 0)
  SetFace("npc006aa010101_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", -19, -82, 0, true, "SCURVE", 0, 0)
  BlendEye("KUREMI_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("KUREMI_01", 0, -100, 0, false, "SCURVE", 0, 0)
  BlendEye("TAKEMIYA_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("TAKEMIYA_01", -31, 38, 0, true, "SCURVE", 0, 0)
  BlendEye("AEGIOMON_B_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("AEGIOMON_B_01", -37, 0, 0, true, "SCURVE", 0, 0)
  BlendEye("SIMONS_01", 34, 0, "SCURVE", 0, 0)
  BlendFace("SIMONS_01", 0, -3, 0, false, "SCURVE", 0, 0)
  BlendEye("npc006aa010101_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("npc006aa010101_01", 0, 0, 0, true, "SCURVE", 0, 0)
  MovePosition2("SIMONS_01", -1.303, 0, 1.753, true, 1, 0)
  MoveRotation("SIMONS_01", 0, 33.569, 0, "LINEAR", 1, true, 0)
  SetCamera(-0.792, 1.409, 2.911, 0, 35, "LINEAR", 0, false, 0)
  SetCameraTarget(-2.611, -0.99, -1.628, "LINEAR", 0, false, 0)
  SetCamera(-0.792, 1.379, 2.911, 0, 35, "LINEAR", 90, true, 0)
  SetCameraTarget(-2.611, 1.61, -1.628, "LINEAR", 90, true, 0)
  SetEnv_All("c1.0", 0)
  Event_PlayBGM(405, 0.5, 0.5)
  FIELD_SET()
  EVENT_START()
  SetMobTransparentRange(9.3, 8.3, 8.3)
  CUT("1.0")
  FadeInWithWait(FADE_BLACK, FADE_TIME)
  WaitFrame(45)
  PlayMotion("SIMONS_01", "e206", 15, true, 0)
  SetFace("SIMONS_01", "F01", 2, 1, FACE_BLENDTIME, 0)
  SetBlink("SIMONS_01", 0, 0.5, 60)
  WaitFrame(150)
  CUT("2.0")
  SetEnv_All("c2.0", 0)
  SetPosition("SIMONS_01", -1.335, 0, 1.404, "LINEAR", 0, 0)
  SetRotation("SIMONS_01", 0, 33.57, 0, "LINEAR", 0, 0)
  SetCamera(-0.249, 0.816, 4.385, 0, 35, "LINEAR", 0, false, 0)
  SetCameraTarget(-0.217, 1.208, 3.342, "LINEAR", 0, false, 0)
  SetCamera(0.111, 0.814, 4.387, 0, 35, "DECEL", 120, true, 0)
  SetCameraTarget(0.143, 1.206, 3.344, "DECEL", 120, true, 0)
  PlayMotion("SIMONS_01", "fn01_01", 0, true, 0)
  MovePosition("SIMONS_01", -0.229, 0, 3.07, false, 1, 0)
  MoveRotation("SIMONS_01", 0, 39.57, 0, "LINEAR", 1, true, 0)
  BlendEye("HERO_01", 19, 0, "SCURVE", 60, 20)
  BlendFace("HERO_01", 40, -4, 0, true, "SCURVE", 60, 20)
  BlendEye("AEGIOMON_B_01", 19, 0, "SCURVE", 15, 0)
  BlendFace("AEGIOMON_B_01", -81, 0, 0, true, "SCURVE", 30, 15)
  BlendEye("TAKEMIYA_01", 0, 0, "SCURVE", 20, 0)
  BlendFace("TAKEMIYA_01", 0, -57, 0, true, "SCURVE", 20, 0)
  BlendEye("KUREMI_01", 0, 0, "SCURVE", 60, 0)
  BlendFace("KUREMI_01", -4, 10, 0, false, "SCURVE", 60, 0)
  PlayMotion("HERO_01", "fn01_01", 3, true, 0)
  SetFace("HERO_01", "E16_M10", 0, 1, FACE_BLENDTIME, 30)
  WaitFrame(85)
  local slot_id = Event_PlaySE(400001, 100, false, 0.3, 0)
  PlayMotion("SIMONS_01", "e017", 15, true, 0)
  SetFace("SIMONS_01", "F02", 0, 1, 10, 0)
  PlayMotion("AEGIOMON_B_01", "e006", 3, true, 25)
  SetFace("AEGIOMON_B_01", "E05_M01", 0, 1, FACE_BLENDTIME, 0)
  WaitFrame(10)
  MessageTalk("m070_040_010")
  MessageTalk("m070_040_020")
  MessageClose()
  WaitFrame(10)
  CUT("3.0")
  SetEnv_All("c3.0", 0)
  ModelVisible("SIMONS_01", false, 0, 0)
  EndMotion("AEGIOMON_B_01", 0)
  PlayMotionBlend("AEGIOMON_B_01", "blend01", 3, false, 15)
  SetFace("AEGIOMON_B_01", "E01_M01", 0, 1, FACE_BLENDTIME, 15)
  BlendEye("AEGIOMON_B_01", -14, 0, "SCURVE", 0, 0)
  SetCamera(-0.186, 1.265, 3.424, 0, 35, "LINEAR", 0, false, 0)
  SetCameraTarget(1.039, 0.647, 4.139, "LINEAR", 0, false, 0)
  WaitFrame(10)
  MessageTalk("m070_040_030")
  MessageClose()
  WaitFrame(10)
  CUT("4.0")
  SetEnv_All("c4.0", 0)
  ModelVisible("SIMONS_01", true, 0, 0)
  SetCamera(0.111, 0.814, 4.387, 0, 35, "LINEAR", 0, false, 0)
  SetCameraTarget(0.143, 1.206, 3.344, "LINEAR", 0, false, 0)
  SetRotation("SIMONS_01", 0, 33.57, 0, "LINEAR", 0, 0)
  SetFace("SIMONS_01", "F01", 0, 2, 0, 0)
  WaitFrame(10)
  MessageTalk("m070_040_040")
  PlayMotionBlend("SIMONS_01", "blend01", 3, false, 0)
  SetFace("SIMONS_01", "F02", 0, 1, 15, 0)
  MessageTalk("m070_040_050")
  MessageClose()
  WaitFrame(10)
  EndMotion("SIMONS_01", 15)
  BlendEye("SIMONS_01", 0, -100, "SCURVE", 15, 20)
  BlendFace("SIMONS_01", 0, -67, -27, false, "SCURVE", 30, 20)
  SetFace("SIMONS_01", "F02", 0, 2, 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 15, 10)
  BlendFace("HERO_01", 0, -25, 0, true, "SCURVE", 30, 10)
  MessageTalk("m070_040_060")
  MessageClose()
  WaitFrame(10)
  CUT("5.0")
  SetEnv_All("c5.0", 0)
  SetCamera(0.448, 1.261, 4.365, 0, 37, "LINEAR", 0, false, 0)
  SetCameraTarget(-0.72, 1.466, 2.647, "LINEAR", 0, false, 0)
  PlayMotion("TAKEMIYA_01", "e021", 3, false, 0)
  PlayMotion("TAKEMIYA_01", "fn01_01", 3, true, 164)
  SetFace("TAKEMIYA_01", "E07_M01", 0, 1, FACE_BLENDTIME, 0)
  BlendEye("SIMONS_01", -11, -67, "SCURVE", 0, 0)
  BlendFace("SIMONS_01", 6, -49, -26, false, "SCURVE", 0, 0)
  SetPosition("SIMONS_01", -0.229, 0, 3.07, "LINEAR", 0, 0)
  SetRotation("SIMONS_01", 0, 15.57, 0, "LINEAR", 0, 0)
  WaitFrame(10)
  MessageTalk("m070_040_070")
  MessageClose()
  WaitFrame(10)
  SetFace("TAKEMIYA_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  CUT("6.0")
  SetEnv_All("c6.0", 0)
  SetCamera(0.579, 1.564, 3.789, 0, 25, "LINEAR", 0, false, 0)
  SetCameraTarget(-0.25, 1.566, 3.016, "LINEAR", 0, false, 0)
  SetPosition("SIMONS_01", -0.229, 0, 3.07, "LINEAR", 0, 0)
  SetRotation("SIMONS_01", 0, 55.07, 0, "LINEAR", 0, 0)
  SetPosition("TAKEMIYA_01", -1.354, 0, 3.076, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, 126.5, 0, "LINEAR", 0, 0)
  SetPosition("AEGIOMON_B_01", 0.202, 0.12, 3.655, "LINEAR", 0, 0)
  SetRotation("AEGIOMON_B_01", 0, 214.5, 0, "LINEAR", 0, 0)
  BlendEye("TAKEMIYA_01", 0, 8, "SCURVE", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 15, 10)
  BlendFace("HERO_01", 0, -25, 0, true, "SCURVE", 15, 10)
  PlayMotion("SIMONS_01", "e013", 5, true, 0)
  SetFace("SIMONS_01", "F02", 0, 2, FACE_BLENDTIME, 0)
  WaitFrame(10)
  BlendEye("SIMONS_01", 0, 39, "SCURVE", 15, 60)
  BlendFace("SIMONS_01", 0, 20, 0, false, "SCURVE", 30, 60)
  MessageTalk("m070_040_080")
  MessageClose()
  WaitFrame(10)
  local slot_01 = Event_PlaySE(404037, 100, false, 0.3, 0)
  Story.OpenCharacterEntry("char_MONIKA_SIMMONS")
  WaitFrame(70)
  Story.IsClosedCharacterEntry()
  WaitFrame(60)
  CUT("7.0")
  SetEnv_All("c7.0", 0)
  SetPosition("HERO_01", 0.604, -0, 3.131, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -73.59, 0, "LINEAR", 0, 0)
  SetPosition("TAKEMIYA_01", -1.354, 0, 2.976, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, 126.5, 0, "LINEAR", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", -15, -10, 0, true, "SCURVE", 0, 0)
  BlendEye("SIMONS_01", 0, 33, "SCURVE", 0, 0)
  BlendFace("SIMONS_01", 0, 27, 0, false, "SCURVE", 0, 0)
  SetCamera(-1.125, 1.842, 4.087, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(0.814, 1.032, 2.685, "LINEAR", 0, false, 0)
  SetFace("HERO_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
  correct = false
  while not Vista.IsSkipping() and not correct do
    BlendEye("SIMONS_01", 0, 33, "SCURVE", 0, 0)
    BlendFace("SIMONS_01", 0, 27, 0, false, "SCURVE", 0, 0)
    SetEnv_All("c7.0", 0)
    SetCamera(-1.125, 1.842, 4.087, 0, 40, "LINEAR", 0, false, 0)
    SetCameraTarget(0.814, 1.032, 2.685, "LINEAR", 0, false, 0)
    SetBlink("SIMONS_01", 0, 1, 0)
    SetMouth("SIMONS_01", 1, 0, 0)
    PlayMotion("SIMONS_01", "fn01_01", 0, true, 0)
    PlayMotion("HERO_01", "fn01_01", 0, true, 0)
    SetFace("HERO_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
    SetFace("SIMONS_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
    WaitFrame(30)
    MessageTalkSel(3, "m070_040_090")
    result = Talk.GetResultSelectedNum()
    if result == RESULT_TALK00 then
      SetFace("HERO_01", "E01_M01", 0, 1, FACE_BLENDTIME, 0)
      PlayMotion("HERO_01", "e002", 5, true, 0)
      SetMouth("HERO_01", 0, 0, 0)
      SetMouth("HERO_01", 1, 0, 30)
      WaitFrame(60)
      CUT("7.0_A1")
      SetEnv_All("7.0_A1", 0)
      SetCamera(0.58, 1.546, 3.833, 0, 25, "LINEAR", 0, false, 0)
      SetCameraTarget(-0.226, 1.548, 3.081, "LINEAR", 0, false, 0)
      BlendEye("SIMONS_01", 0, 33, "SCURVE", 10, 0)
      BlendFace("SIMONS_01", 0, 17, 0, false, "SCURVE", 30, 0)
      PlayMotion("SIMONS_01", "e007", 20, true, 0)
      SetFace("HERO_01", "E02_M01", 0, 1, FACE_BLENDTIME, 0)
      SetFace("SIMONS_01", "F02", 0, 2, 0, 0)
      EndMotion("HERO_01", 0)
      WaitFrame(10)
      MessageTalk("m070_040_100")
      MessageTalk("m070_040_110")
      MessageTalk("m070_040_120")
      MessageClose()
      WaitFrame(10)
      EndMotion("SIMONS_01", 0)
      correct = true
    elseif result == RESULT_TALK01 then
      PlayMotion("HERO_01", "e012", 10, false, 0)
      SetFace("HERO_01", "E12_M12", 0, 1, FACE_BLENDTIME, 0)
      SetMouth("HERO_01", 0, 0, 0)
      SetMouth("HERO_01", 1, 0, 45)
      WaitFrame(60)
      CUT("7.0_B1")
      SetEnv_All("7.0_B1", 0)
      SetCamera(0.485, 1.536, 3.98, 0, 25, "LINEAR", 0, false, 0)
      SetCameraTarget(-0.269, 1.559, 3.134, "LINEAR", 0, false, 0)
      BlendEye("SIMONS_01", 0, 20, "SCURVE", 15, 0)
      BlendFace("SIMONS_01", 0, 27, 0, false, "SCURVE", 30, 0)
      PlayMotion("SIMONS_01", "e023", 10, true, 0)
      SetFace("SIMONS_01", "E04_M02", 0, 2, FACE_BLENDTIME, 0)
      EndMotion("HERO_01", 0)
      WaitFrame(10)
      MessageTalk("m070_040_130")
      PlayMotionBlend("SIMONS_01", "blend02", 0, false, 0)
      MessageTalk("m070_040_140")
      EndMotion("SIMONS_01", 0)
      MessageTalk("m070_040_150")
      MessageClose()
      WaitFrame(10)
      EndMotion("SIMONS_01", 0)
    elseif result == RESULT_TALK02 then
      PlayMotion("HERO_01", "e012", 5, true, 0)
      SetFace("HERO_01", "E08_M02", 0, 1, FACE_BLENDTIME, 0)
      SetMouth("HERO_01", 0, 0, 0)
      SetMouth("HERO_01", 1, 0, 30)
      WaitFrame(60)
      CUT("7.0_C1")
      SetEnv_All("7.0_C1", 0)
      SetCamera(0.485, 1.536, 3.98, 0, 25, "LINEAR", 0, false, 0)
      SetCameraTarget(-0.269, 1.559, 3.134, "LINEAR", 0, false, 0)
      BlendEye("SIMONS_01", 0, 0, "SCURVE", 15, 0)
      BlendFace("SIMONS_01", 0, 0, 0, false, "SCURVE", 30, 0)
      PlayMotion("SIMONS_01", "e008", 10, true, 0)
      SetFace("SIMONS_01", "E01_M01", 2, 1, FACE_BLENDTIME, 0)
      SetBlink("SIMONS_01", 2, 1, 0)
      SetMouth("SIMONS_01", 1, 0, 0)
      EndMotion("HERO_01", 0)
      SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
      WaitFrame(10)
      MessageTalk("m070_040_160")
      EndMotion("SIMONS_01", 0)
      SetBlink("SIMONS_01", 0, 1, 0)
      BlendEye("SIMONS_01", 0, 20, "SCURVE", 10, 0)
      BlendFace("SIMONS_01", 0, 10, 0, false, "SCURVE", 20, 0)
      MessageTalk("m070_040_170")
      MessageClose()
      WaitFrame(10)
      EndMotion("SIMONS_01", 0)
    end
  end
  CUT("8.0")
  SetEnv_All("c8.0", 0)
  SetCamera(0.695, 1.25, 4.851, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(-0.132, 1.304, 3.032, "LINEAR", 0, false, 0)
  SetPosition("TAKEMIYA_01", -1.354, 0, 2.976, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, 126, 0, "LINEAR", 0, 0)
  SetPosition("HERO_01", 0.604, -0, 3.131, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -92.09, 0, "LINEAR", 0, 0)
  BlendEye("SIMONS_01", 25, 0, "SCURVE", 15, 0)
  BlendFace("SIMONS_01", 34, -14, 0, false, "SCURVE", 20, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", -13, 1, 0, true, "SCURVE", 0, 0)
  PlayMotion("SIMONS_01", "e013", 15, true, 0)
  WaitFrame(10)
  MessageTalk("m070_040_180")
  MessageClose()
  Event_StopBGM(1, 0)
  WaitFrame(10)
  BackFade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
  Vista.SetKeepBGM()
  Vista.SetKeepBGMWithMapChange()
  EVENT_END()
  Sound.StopBGM(0)
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m070_040()
end
