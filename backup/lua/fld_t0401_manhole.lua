require("include")

function fld_t0401_manhole()
  EVENT_BEGIN()
  SetMapStatus("Disable")
  if Debug.IsEventView() then
    LoadMap("t0401")
  end
  SetEventCutNo(3)
  LoadModel("HERO_01", "Player")
  Vista.LoadAnimation("HERO_01", "fn01_01")
  Vista.LoadAnimation("HERO_01", "e508")
  Vista.LoadAnimation("HERO_01", "fw01_01")
  Vista.LoadAnimation("HERO_01", "fw01_01_end01")
  LoadEnvironmentFile("c01", "fld_t0401_manhole_c01")
  LoadEnvironmentFile("c02", "fld_t0401_manhole_c02")
  WaitVistaLoad()
  SetPosition("HERO_01", -41.236, -0.02, -7.493, "LINEAR", 0, 0)
  SetRotation("HERO_01", -178, 45, -180, "LINEAR", 0, 0)
  SetScale("HERO_01", 1, 1, 1)
  PlayMotion("HERO_01", "fn01_01", 0, true, 0)
  PlayMotionFace("HERO_01", "", "", 0, 0)
  SetBlink("HERO_01", 0, 1, 0)
  SetMouth("HERO_01", 1, 0, 0)
  BlendEye("HERO_01", 20, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
  SetCamera(-41.174, 2.081, -6.797, 0, 35, "LINEAR", 0, false, 0)
  SetCameraTarget(-40.563, 0.105, -8.887, "LINEAR", 0, false, 0)
  ResetEnvironmentSettings()
  SetEnvironmentFile("c01")
  FIELD_SET()
  Field_CancelInvisiblePlayer(INVISIBLE_KEY_EVENT, 0, false, false)
  EVENT_START()
  CUT(1)
  local def_text = "t0401"
  Field_Talk_Start(def_text, 1)
  Message(800000)
  MessageTalkSel(2, 800001)
  local result = Talk.GetResultSelectedNum()
  if result == RESULT_TALK00 then
    Field_Talk_End()
    SetPosition("HERO_01", -40.953, -0.034, -7.776, "LINEAR", 36, 4)
    PlayMotion("HERO_01", "fw01_01", 10, true, 0)
    PlayMotion("HERO_01", "fw01_01_end01", 12, false, 30)
    WaitFrame(18)
    Fade_Out(0, 10)
    WaitFrame(30)
    CUT(2)
    ResetEnvironmentSettings()
    SetEnvironmentFile("c02")
    SetCamera(-40.878, 1.296, -8.31, 0, 45, "LINEAR", 0, false, 0)
    SetCameraTarget(-40.251, -0.375, -9.156, "LINEAR", 0, false, 0)
    SetCamera(-40.848, 1.215, -8.351, 0, 45, "DECEL", 80, false, 0)
    SetCameraTarget(-40.251, -0.375, -9.156, "DECEL", 80, false, 0)
    SetPosition("HERO_01", -40.355, 0, -9.42, "LINEAR", 0, 0)
    SetRotation("HERO_01", 0, 180, 0, "LINEAR", 0, 0)
    SetScale("HERO_01", 1, 1, 1)
    PlayMotion("HERO_01", "e508", 0, true, 0)
    Fade_In(0, 10)
    WaitFrame(55)
    Fade_Out(0, 15)
    WaitFrame(15)
    EVENT_END()
    MapChange("d", 1101, "start_00", true, 0, 0)
  elseif result == RESULT_TALK01 then
    Field_Talk_End()
    SetPosition("HERO_01", -41.236, -0.02, -6.783, "LINEAR", 0, 0)
  end
  EVENT_END()
end

function CUT(cut_no)
  CUT_START()
end

function main()
  fld_t0401_manhole()
end
