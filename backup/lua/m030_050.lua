require("include")

function m030_050()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m030")
  SetEventCutNo(5)
  if Debug.IsEventView() then
    SetTimeZone("Noon")
    SetTimeAxis("A2020_dbef_30")
    LoadMap("d0802")
  end
  LoadModel("HERO_01", "Player")
  LoadModel("DIGI_LUNAMON_01", "char_LUNAMON")
  LoadModel("DIGI_CORONAMON_01", "char_CORONAMON")
  LoadModel("DIGI_MINERVAMON_01", "char_MINERVAMON")
  LoadModel("chr805_01", "char_BLACKSHADOW")
  LoadSceneViewerResource("c1.0", "d0802f_za")
  LoadSceneViewerResource("c2.0", "d0802f_za")
  LoadSceneViewerResource("c3.0", "d0802f_za")
  LoadSceneViewerResource("c3.0_B1", "d0802f_za")
  LoadSceneViewerResource("c3.0_C1", "d0802f_za")
  LoadEnvironmentFile("c1.0", "es_m030_050_c1.0")
  LoadEnvironmentFile("c2.0", "es_m030_050_c2.0")
  LoadEnvironmentFile("c3.0", "es_m030_050_c3.0")
  LoadEnvironmentFile("c3.0_B1", "es_m030_050_c3.0_B1")
  LoadEnvironmentFile("c3.0_C1", "es_m030_050_c3.0_C1")
  WaitVistaLoad()
  NpcInvisible(FOR_ALL)
  SetPosition("HERO_01", -13.344, 0, 3.237, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 100, 0, "LINEAR", 0, 0)
  SetPosition("DIGI_LUNAMON_01", -17.572, 0, 1.537, "LINEAR", 0, 0)
  SetRotation("DIGI_LUNAMON_01", 0, 65.5, 0, "LINEAR", 0, 0)
  SetPosition("DIGI_CORONAMON_01", -17.553, 0.017, 0.565, "LINEAR", 0, 0)
  SetRotation("DIGI_CORONAMON_01", 0, 51, 0, "LINEAR", 0, 0)
  SetPosition("DIGI_MINERVAMON_01", -21.833, 0.343, -2.34, "LINEAR", 0, 0)
  SetRotation("DIGI_MINERVAMON_01", 0, 64, 0, "LINEAR", 0, 0)
  SetPosition("chr805_01", -2.442, 0, 0.607, "LINEAR", 0, 0)
  SetRotation("chr805_01", 0, 107, 0, "LINEAR", 0, 0)
  PlayMotion("DIGI_LUNAMON_01", "e004", 0, true, 0)
  SetFace("DIGI_LUNAMON_01", "F01", 0, 1, 0, 0)
  PlayMotion("DIGI_CORONAMON_01", "e007", 0, true, 0)
  SetFace("DIGI_CORONAMON_01", "F03", 0, 1, 0, 0)
  PlayMotion("DIGI_MINERVAMON_01", "bn02", 0, true, 0)
  SetFace("DIGI_MINERVAMON_01", "F01", 0, 1, 0, 0)
  PlayMotion("HERO_01", "bn01", 0, true, 0)
  SetFace("HERO_01", "E16_M10", 0, 1, 0, 0)
  PlayMotion("chr805_01", "bn01", 0, true, 0)
  BlendFaceDigi("DIGI_LUNAMON_01", 0, 0, 0, "SCURVE", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 0, 0)
  BlendFaceDigi("chr805_01", 0, 0, 0, "SCURVE", 0, 0)
  SetEnv_All("c1.0", 0)
  SetCamera(0.265, 0.378, -4.377, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(-1.094, 2.211, 0.924, "LINEAR", 0, false, 0)
  SetCamera(-2.497, 0.095, -4.141, 0, 40, "LINEAR", 180, ture, 0)
  SetCameraTarget(-0.732, 2.368, 0.861, "LINEAR", 180, true, 0)
  BlendFaceDigi("DIGI_MINERVAMON_01", -45, 13, 0, "SCURVE", 0, 0)
  FIELD_SET()
  EVENT_START()
  CUT("1.0")
  Fade_In(0, FADE_TIME)
  WaitFrame(FADE_TIME)
  PlayMotion("chr805_01", "e500", 5, false, 0)
  WaitFrame(100)
  CUT("2.0")
  SetEnv_All("c2.0", 0)
  SetCamera(-20.993, 1.433, -1.782, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-21.407, 1.429, -1.989, "LINEAR", 0, false, 0)
  SetCamera(-12.083, 1.403, 3.323, 0, 30, "SCURVE", 15, false, 70)
  SetCameraTarget(-22.1, 1.214, -0.286, "SCURVE", 15, false, 70)
  BlendEye("HERO_01", 28, 56, "SCURVE", 20, 70)
  BlendFace("HERO_01", 0, 45, 0, true, "SCURVE", 20, 70)
  MessageTalk("m030_050_010")
  MessageClose()
  WaitFrame(10)
  CUT("3.0")
  PlayMotion("chr805_01", "bn01", 0, true, 0)
  correct = false
  while not correct and not Vista.IsSkipping() do
    SetEnv_All("c3.0", 0)
    SetCamera(-12.671, 1.569, 2.738, 0, 30, "LINEAR", 0, false, 0)
    SetCameraTarget(-13.345, 1.52, 3.269, "LINEAR", 0, false, 0)
    PlayMotion("HERO_01", "fn01_01", 0, true, 0)
    SetFace("HERO_01", "E03_M10", 0, 1, 0, 0)
    BlendEye("HERO_01", 0, 0, "SCURVE", 20, 0)
    BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 20, 0)
    MessageTalkSel(3, "m030_050_020")
    result = Talk.GetResultSelectedNum()
    if result == RESULT_TALK00 then
      SetFace("HERO_01", "E03_M04", 0, 1, FACE_BLENDTIME, 0)
      WaitFrame(6)
      SetCamera(-15.246, 1.012, 2.661, 0, 40, "SCURVE", 50, false, 0)
      SetCameraTarget(-11.921, 1.317, 2.831, "SCURVE", 50, false, 0)
      PlayMotion("HERO_01", "e018", 5, true, 0)
      Event_PlaySE(400002, 100, false, 0, 0.5)
      WaitFrame(75)
      correct = true
    elseif result == RESULT_TALK01 then
      PlayMotionBlend("HERO_01", "blend02", 0, false, 0)
      SetFace("HERO_01", "F10", 0, 0, FACE_BLENDTIME, 0)
      SetFace("HERO_01", "F10", 0, 1, FACE_BLENDTIME, 50)
      WaitFrame(60)
      CUT("3.0_B1")
      SetEnv_All("c3.0_B1", 0)
      SetCamera(-15.962, 0.802, 1.876, 0, 20, "LINEAR", 0, false, 0)
      SetCameraTarget(-17.921, 0.427, 1.466, "LINEAR", 0, false, 0)
      MessageTalk("m030_050_030")
      MessageClose()
      WaitFrame(10)
    elseif result == RESULT_TALK02 then
      PlayMotionBlend("HERO_01", "blend02", 0, false, 0)
      SetFace("HERO_01", "E03_M04", 0, 0, FACE_BLENDTIME, 0)
      SetFace("HERO_01", "E03_M04", 0, 1, FACE_BLENDTIME, 50)
      WaitFrame(60)
      EndMotion("HERO_01", 0)
      WaitFrame(30)
      CUT("3.0_C1")
      SetEnv_All("c3.0_C1", 0)
      SetCamera(-20.993, 1.433, -1.782, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(-21.407, 1.429, -1.989, "LINEAR", 0, false, 0)
      MessageTalk("m030_050_040")
      MessageClose()
      WaitFrame(10)
    end
  end
  Fade_OutNoLoadingWithWait(0, FADE_TIME)
  EVENT_END()
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m030_050()
end
