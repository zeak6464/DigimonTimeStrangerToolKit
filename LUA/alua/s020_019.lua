S020_019 = {
  ID = 19,
  STEP_001 = 1,
  STEP_005 = 5,
  STEP_010 = 10,
  STEP_015 = 15,
  STEP_255 = 255,
  Flg01 = "FLAG_SUB_020_019_001",
  Flg02 = "FLAG_SUB_020_019_002",
  Flg03 = "FLAG_SUB_020_019_003",
  Flg04 = "FLAG_SUB_020_019_004",
  Flg05 = "FLAG_SUB_020_019_005",
  Flg06 = "FLAG_SUB_020_019_006"
}
local text_file = "s020_019"
local base = "s020_019_"

function S020_019:Event_010()
  if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
    Cam.Inst:Set(95.57, -5.14, -89.26, 102, -5.01, -81.62, default, 30)
    local game_index = GetIndex(NPC, "s020_019_001")
    Field.ObjectLoadMotion(NPC, game_index, "bn01")
    Field.ObjectLoadMotion(NPC, game_index, "bn02")
    Field.ObjectLoadMotion(NPC, game_index, "fq01")
    Field.ObjectLoadMotion(NPC, game_index, "fq02")
    Field.ObjectLoadMotion(NPC, game_index, "fe02")
    Field.ObjectLoadMotion(NPC, game_index, "fe04")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    Field.ObjectLoadMotion(PLAYER, 1, "e013")
    Field.ObjectLoadMotion(PLAYER, 1, "e015")
    Field.ObjectLoadMotion(PLAYER, 1, "e018")
    Field.ObjectLoadMotion(PLAYER, 1, "e019")
    if not Flg.Check(self.Flg01) then
      local tlk = Tlk:new(text_file, 1, true)
      HideMinimap(true)
      HideGuide(true)
      tlk:StartTalkAndCancelDigimonRide()
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
      tlk:Message(base .. "010")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      tlk:Message(base .. "020")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
      tlk:Message(base .. "030")
      local result = tlk:Select(3, base .. "040")
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      if result == RESULT_TALK00 then
        tlk:Message(base .. "050")
      elseif result == RESULT_TALK01 then
        tlk:Message(base .. "060")
      elseif result == RESULT_TALK02 then
        tlk:Message(base .. "070")
      end
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
      tlk:Message(base .. "080")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      tlk:Message(base .. "090")
      tlk:Message(base .. "100")
      result = tlk:Select(3, base .. "110")
      WaitFrame(15)
      if result == RESULT_TALK00 then
        Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
        tlk:Message(base .. "120")
      elseif result == RESULT_TALK01 then
        Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
        tlk:Message(base .. "130")
      elseif result == RESULT_TALK02 then
        Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
        tlk:Message(base .. "140")
      end
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
      tlk:Message(base .. "150")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      tlk:Message(base .. "160")
      tlk:Message(base .. "170")
      result = tlk:Select(3, base .. "180")
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      if result == RESULT_TALK00 then
        tlk:Message(base .. "190")
      elseif result == RESULT_TALK01 then
        tlk:Message(base .. "200")
      elseif result == RESULT_TALK02 then
        tlk:Message(base .. "210")
        tlk:EndTalk()
        Flg.Set(self.Flg01)
        HideMinimap(false)
        HideGuide(false)
        goto lbl_460
      end
      Field.ObjectPlayMotion(NPC, game_index, "bn02", 15, true)
      tlk:Message(base .. "260")
      tlk:Message(base .. "270")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      tlk:Message(base .. "280")
      tlk:EndTalk(true)
      Qst.Sub:Start(self.ID, 1, false)
      HideMinimap(false)
      HideGuide(false)
      Qst.Sub:Set(self.ID, self.STEP_005)
      Flg.Set(self.Flg01)
      Field_CancelInvisibleFollowerAllGuest(0, 15, false, false)
      Field_CancelInvisibleFollowerAllPartyMember(0, 15, false, false)
      ::lbl_460::
      Cam.Inst:Clear(30)
    elseif not Flg.Check(self.Flg04) then
      local tlk = Tlk:new(text_file, 1, true)
      HideMinimap(true)
      HideGuide(true)
      tlk:StartTalkAndCancelDigimonRide()
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
      tlk:Message(base .. "220")
      local result = tlk:Select(2, base .. "230")
      WaitFrame(15)
      if result == RESULT_TALK00 then
        Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fe02", 10, 10)
        tlk:Message(base .. "240")
      elseif result == RESULT_TALK01 then
        Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
        tlk:Message(base .. "250")
        tlk:EndTalk()
        HideMinimap(false)
        HideGuide(false)
        goto lbl_615
      end
      Field.ObjectPlayMotion(NPC, game_index, "bn02", 15, true)
      tlk:Message(base .. "260")
      tlk:Message(base .. "270")
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
      tlk:Message(base .. "280")
      tlk:EndTalk(true)
      Qst.Sub:Start(self.ID, 1, false)
      HideMinimap(false)
      HideGuide(false)
      Qst.Sub:Set(self.ID, self.STEP_005)
      Field_CancelInvisibleFollowerAllGuest(0, 15, false, false)
      Field_CancelInvisibleFollowerAllPartyMember(0, 15, false, false)
      ::lbl_615::
      Cam.Inst:Clear(30)
    end
  elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_015) then
    local game_index = GetIndex(NPC, "s020_019_001")
    Field.ObjectLoadMotion(NPC, game_index, "bn01")
    Field.ObjectLoadMotion(NPC, game_index, "bn02")
    Field.ObjectLoadMotion(NPC, game_index, "fq01")
    Field.ObjectLoadMotion(NPC, game_index, "fq02")
    Field.ObjectLoadMotion(NPC, game_index, "fe02")
    Field.ObjectLoadMotion(NPC, game_index, "fe04")
    Cam.Inst:Set(95.57, -5.14, -89.26, 102, -5.01, -81.62, default, 30)
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    Field.ObjectPlayMotion(NPC, game_index, "bn02", 15, true)
    tlk:Message(base .. "260")
    tlk:Message(base .. "270")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
    tlk:Message(base .. "280")
    tlk:EndTalk()
    Cam.Inst:Clear(30)
  end
end

function S020_019:Event_020()
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_255) then
    if Guest.IsExistNum(3) then
      INFO_WINDOW(10050)
      goto lbl_315
    else
      local nepu_index = GetIndex(NPC, "npc_0001")
      Field.ObjectLoadMotion(NPC, nepu_index, "e101")
      Field.ObjectLoadMotion(NPC, nepu_index, "e104")
      Field.ObjectLoadMotion(NPC, nepu_index, "e105")
      Field.ObjectLoadMotion(NPC, nepu_index, "e106")
      Field.ObjectLoadMotion(NPC, nepu_index, "e108")
      Field.ObjectLoadMotion(PLAYER, 1, "e002")
      Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
      Field.ObjectLoadMotion(PLAYER, 1, "e008")
      Field.ObjectLoadMotion(PLAYER, 1, "e012")
      Field.ObjectLoadMotion(PLAYER, 1, "e013")
      Field.ObjectLoadMotion(PLAYER, 1, "e015")
      Field.ObjectLoadMotion(PLAYER, 1, "e018")
      Field.ObjectLoadMotion(PLAYER, 1, "e019")
      Cam.Inst:Set(1.89, 40.55, -114.513, 3.973, 37.28, -105.29, default, 30)
      if not Flg.Check(self.Flg02) then
        Flg.Set(self.Flg02)
        local tlk = Tlk:new(text_file, 1, true)
        HideMinimap(true)
        HideGuide(true)
        tlk:StartTalkAndCancelDigimonRide()
        Field.ObjectPlayMotion(NPC, nepu_index, "e101", 15, true)
        tlk:Message(base .. "290")
        Field.ObjectPlayMotion(NPC, nepu_index, "e108", 15, true)
        tlk:Message(base .. "300")
        Field.ObjectPlayMotion(NPC, nepu_index, "e101", 15, true)
        tlk:Message(base .. "310")
        tlk:EndTalk()
        Flg.Set(self.Flg03)
        Flg.Set(self.Flg04)
        INFO_WINDOW(7058)
        Guest.Add(GST_NEPTUNUS)
        Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
        FieldObjectSync(NPC, true)
        WaitFrame(25)
        FadeAllInWithWait(FADE_BLACK, FADE_TIME)
        HideMinimap(false)
        HideGuide(false)
        Qst.Sub:Set(self.ID, self.STEP_010)
        Qst.Sub:Set(self.ID, self.STEP_015)
      elseif not Flg.Check(self.Flg03) and not Flg.Check(self.Flg04) then
        local tlk = Tlk:new(text_file, 1, true)
        tlk:StartTalkAndCancelDigimonRide()
        tlk:Message(base .. "320")
        local result = tlk:Select(2, base .. "330")
        WaitFrame(15)
        if result == RESULT_TALK00 then
          tlk:Message(base .. "340")
        elseif result == RESULT_TALK01 then
          tlk:Message(base .. "350")
          tlk:EndTalk()
          goto lbl_310
        end
        Flg.Set(self.Flg03)
        Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
        FieldObjectSync(NPC, true)
        WaitFrame(25)
        FadeAllInWithWait(FADE_BLACK, FADE_TIME)
        tlk:EndTalk()
        HideMinimap(false)
        HideGuide(false)
      end
      ::lbl_310::
      Cam.Inst:Clear(30)
    end
  end
  ::lbl_315::
end

function S020_019:Event_030()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) and Flg.Check(self.Flg03) and not Flg.Clear(self.Flg04) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "360")
    tlk:EndTalk()
    Flg.Set(self.Flg04)
    INFO_WINDOW(7058)
    Guest.Add(GST_NEPTUNUS)
    FieldObjectSync(FOR_ALL, true)
    Qst.Sub:Set(self.ID, self.STEP_015)
  end
end

function S020_019:Event_040()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) and Flg.Check(self.Flg03) and Flg.Check(self.Flg04) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "700")
    Field.MovePlayerToRelativePosFrame(0, 3, 30)
    tlk:EndTalk()
  end
end

function S020_019:Event_045()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) and Flg.Check(self.Flg03) and Flg.Check(self.Flg04) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "700")
    tlk:EndTalk()
  end
end

function S020_019:Event_050()
  if Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_255) and Flg.Check(self.Flg03) and Flg.Check(self.Flg04) then
    local nepu_index = GetIndex(NPC, "s020_019_nepu_01")
    local game_index = GetIndex(NPC, "s020_019_001")
    Field.ObjectLoadMotion(NPC, game_index, "bn01")
    Field.ObjectLoadMotion(NPC, game_index, "bn02")
    Field.ObjectLoadMotion(NPC, game_index, "fq01")
    Field.ObjectLoadMotion(NPC, game_index, "fq02")
    Field.ObjectLoadMotion(NPC, game_index, "fe02")
    Field.ObjectLoadMotion(NPC, game_index, "fe04")
    Field.ObjectLoadMotion(NPC, nepu_index, "e002")
    Field.ObjectLoadMotion(NPC, nepu_index, "e004")
    Field.ObjectLoadMotion(NPC, nepu_index, "e005")
    Field.ObjectLoadMotion(NPC, nepu_index, "bn01")
    Field.ObjectLoadMotion(NPC, nepu_index, "bn02")
    Field.ObjectLoadMotion(NPC, nepu_index, "fq01")
    Field.ObjectLoadMotion(NPC, nepu_index, "fq02")
    Field.ObjectLoadMotion(NPC, nepu_index, "fe02")
    Field.ObjectLoadMotion(NPC, nepu_index, "fe04")
    local tlk = Tlk:new(text_file, 1, true)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    HideMinimap(true)
    HideGuide(true)
    tlk:StartTalkAndCancelDigimonRide()
    Flg.Set(self.Flg05)
    FieldObjectSync(FOR_ALL, true)
    Cam.Inst:Set(98.026, -4.258, -85.873, 98.81, -5.16, -75.94, default, 0)
    Field.ObjectSetPos(FLD_OBJ_PLAYER, 1, 96.43, -7.2, -83.28)
    Field.ObjectSetRotationY(FLD_OBJ_PLAYER, 1, 0, 0)
    WaitFrame(30)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
    tlk:Message(base .. "440")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e002", 10, 10)
    tlk:Message(base .. "450")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
    tlk:Message(base .. "460")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fe04", 10, 10)
    tlk:Message(base .. "470")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fq01", 10, 10)
    tlk:Message(base .. "480")
    tlk:MessageClose()
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fe02", 10, 10)
    WaitFrame(15)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    WaitFrame(30)
    Motion.Gimmick:Play("gim_0006", "e001", false)
    ColOff("wall_cl_0006")
    local obj = Obj:new(GIM, "gim_0006")
    obj:Invisible()
    PlaySE(401009, 100)
    WaitFrame(30)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    WaitFrame(30)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
    tlk:Message(base .. "490")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e002", 10, 10)
    tlk:Message(base .. "500")
    tlk:Message(base .. "510")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fe04", 10, 10)
    tlk:Message(base .. "520")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fq01", 10, 10)
    tlk:Message(base .. "530")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq02", 10, 10)
    tlk:Message(base .. "540")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fe02", 10, 10)
    tlk:Message(base .. "550")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e005", 10, 10)
    tlk:Message(base .. "560")
    tlk:Message(base .. "570")
    tlk:Message(base .. "580")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e002", 10, 10)
    tlk:Message(base .. "590")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e004", 10, 10)
    tlk:Message(base .. "600")
    tlk:Message(base .. "610")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fq01", 10, 10)
    tlk:Message(base .. "620")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
    tlk:Message(base .. "630")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Field.ObjectLookAtTheObject(NPC, nepu_index, PLAYER, 1, 30)
    Obj:new(NPC, "sub_200_hiroko"):Invisible()
    Cam.Inst:Set(103.227, -3.38, -85.735, 94.49, -6.254, -81.81, default, 0)
    Obj:new(PLAYER, ""):SetRotationYToObject(NPC, "s020_019_nepu_01", 0)
    Obj:new(NPC, "s020_019_nepu_01"):SetRotationYToObject(PLAYER, "", 0)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "e002", 10, 10)
    tlk:Message(base .. "640")
    tlk:Message(base .. "650")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, nepu_index, "fq01", 10, 10)
    tlk:Message(base .. "660")
    tlk:EndTalk(true)
    Flg.Clear(self.Flg03)
    Flg.Clear(self.Flg04)
    Flg.Set(self.Flg06)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Cam.Inst:Clear(0)
    Obj:new(NPC, "sub_200_hiroko"):CancelInvisible()
    FieldObjectSync(FOR_ALL, false)
    WaitFrame(15)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    HideMinimap(false)
    HideGuide(false)
    INFO_WINDOW(7059)
    Guest.Delete(GST_NEPTUNUS)
    Qst.Sub:End(self.ID, self.STEP_255)
    Field_CancelInvisibleFollowerAllGuest(0, 15, false, false)
    Field_CancelInvisibleFollowerAllPartyMember(0, 15, false, false)
  end
end

function S020_019:Event_060()
  local game_index = GetIndex(NPC, "S020_019_game_01")
  Field.ObjectLoadMotion(NPC, game_index, "bn01")
  Field.ObjectLoadMotion(NPC, game_index, "bn02")
  Field.ObjectLoadMotion(NPC, game_index, "fq01")
  Field.ObjectLoadMotion(NPC, game_index, "fq02")
  Field.ObjectLoadMotion(NPC, game_index, "fe02")
  Field.ObjectLoadMotion(NPC, game_index, "fe04")
  local tlk = Tlk:new(text_file, 1, true)
  tlk:StartTalkAndCancelDigimonRide()
  Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
  tlk:Message(base .. "670")
  tlk:Message(base .. "680")
  Field.ObjectPlayMotionWithStartMoveMotion(NPC, game_index, "fq01", 10, 10)
  tlk:Message(base .. "690")
  tlk:EndTalk()
end
