require("include")

function m020_140()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m020")
  SetEventCutNo(5)
  if Debug.IsEventView() then
    SetTimeZone("Evening")
    SetTimeAxis("X2028_daft_20")
    LoadMap("d1403")
  end
  LoadModel("HERO_01", "Player")
  LoadModel("PIYOMON_01", "char_PIYOMON")
  LoadSceneViewerResource("c1.0", "d1403f_ce")
  LoadSceneViewerResource("c2.0", "d1403f_ce")
  LoadSceneViewerResource("c3.0", "d1403f_ce")
  LoadSceneViewerResource("c3.0_A1", "d1403f_ce")
  LoadSceneViewerResource("c3.0_B1", "d1403f_ce")
  LoadSceneViewerResource("c4.0", "d1403f_ce")
  LoadSceneViewerResource("c5.0", "d1403f_ce")
  LoadEnvironmentFile("c1.0", "es_m020_140_c1.0")
  LoadEnvironmentFile("c2.0", "es_m020_140_c2.0")
  LoadEnvironmentFile("c3.0", "es_m020_140_c3.0")
  LoadEnvironmentFile("c3.0_A1", "es_m020_140_c3.0_A1")
  LoadEnvironmentFile("c3.0_B1", "es_m020_140_c3.0_B1")
  LoadEnvironmentFile("c4.0", "es_m020_140_c4.0")
  LoadEnvironmentFile("c5.0", "es_m020_140_c5.0")
  WaitVistaLoad()
  SetPosition("HERO_01", -53.436, 0, -1.94, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -80, 0, "LINEAR", 0, 0)
  SetScale("HERO_01", 1, 1, 1)
  SetPosition("PIYOMON_01", -53.716, 0, -0.28, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, 239, 0, "LINEAR", 0, 0)
  SetScale("PIYOMON_01", 0.9, 0.9, 0.9)
  PlayMotion("HERO_01", "fn01_01", 0, true, 0)
  SetFace("HERO_01", "F15", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("PIYOMON_01", "bn01", 0, true, 0)
  SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, -18, 0, true, "SCURVE", 0, 0)
  BlendFaceDigi("PIYOMON_01", 0, 30, 0, "LINEAR", 0, 0)
  SetCamera(-50.5, 1.66, -2.399, 0, 60, "LINEAR", 0, true, 0)
  SetCameraTarget(-92.663, 0.034, 2.729, "LINEAR", 0, true, 0)
  SetCamera(-50.5, 1.66, -2.787, 0, 60, "LINEAR", 180, true, 0)
  SetCameraTarget(-92.663, 0.034, 2.254, "LINEAR", 180, true, 0)
  FIELD_SET()
  EVENT_START()
  CUT(1)
  Fade_In(0, 0)
  SetEnv_All("c1.0", 0)
  WaitFrame(120)
  CUT(2)
  SetEnv_All("c2.0", 0)
  SetPosition("HERO_01", -53.846, 0, -1.875, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -58.5, 0, "LINEAR", 0, 0)
  SetPosition("PIYOMON_01", -53.716, 0, -0.28, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, 225.5, 0, "LINEAR", 0, 0)
  SetCamera(-54.739, 2.234, -3.003, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-52.912, -0.225, 0.456, "LINEAR", 0, false, 0)
  BlendFaceDigi("PIYOMON_01", -20, -90, 0, "LINEAR", 20, 0)
  BlendFace("HERO_01", 62, 48, 0, true, "SCURVE", 20, 20)
  SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
  MessageTalk("m020_140_010")
  MessageClose()
  WaitFrame(10)
  Vista.SetSkip(false, true)
  CUT(3)
  SetEnv_All("c3.0", 0)
  correct = false
  while not Vista.IsSkipping() and not correct do
    SetPosition("HERO_01", -53.846, 0, -1.875, "LINEAR", 0, 0)
    SetRotation("HERO_01", 0, -42, 0, "LINEAR", 0, 0)
    SetPosition("PIYOMON_01", -53.716, 0, -0.28, "LINEAR", 0, 0)
    SetRotation("PIYOMON_01", 0, 215, 0, "LINEAR", 0, 0)
    SetCamera(-54.632, 0.222, 1.111, 0, 30, "LINEAR", 0, false, 0)
    SetCameraTarget(-53.334, 1.094, -1.927, "LINEAR", 0, false, 0)
    MessageTalkSel(3, "m020_140_020")
    result = Talk.GetResultSelectedNum()
    if result == RESULT_TALK00 then
      Flg.Set("FLAG_MAIN_01_225")
      PlayMotion("HERO_01", "e021", 5, false, 0)
      PlayMotion("HERO_01", "fn01_01", 3, true, 120)
      SetFace("HERO_01", "E02_M04", 0, 0, FACE_BLENDTIME, 0)
      SetFace("HERO_01", "E02_M04", 0, 1, FACE_BLENDTIME, 60)
      WaitFrame(90)
      SetCamera(-54.577, 1.304, -1.497, 0, 40, "LINEAR", 0, false, 0)
      SetCameraTarget(-53.951, 0.716, -0.669, "LINEAR", 0, false, 0)
      SetEnv_All("c3.0_A1", 0)
      WaitFrame(5)
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      MessageTalk("m020_140_030")
      MessageClose()
      WaitFrame(10)
      correct = true
    elseif result == RESULT_TALK01 then
      Flg.Set("FLAG_MAIN_01_225")
      PlayMotionBlend("HERO_01", "blend02", 3, false, 0)
      SetFace("HERO_01", "E02_M04", 0, 0, FACE_BLENDTIME, 0)
      SetFace("HERO_01", "E02_M04", 0, 1, FACE_BLENDTIME, 50)
      WaitFrame(80)
      SetCamera(-54.577, 1.304, -1.497, 0, 40, "LINEAR", 0, false, 0)
      SetCameraTarget(-53.951, 0.716, -0.669, "LINEAR", 0, false, 0)
      SetEnv_All("c3.0_B1", 0)
      PlayMotion("PIYOMON_01", "fe01", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
      MessageTalk("m020_140_040")
      MessageClose()
      WaitFrame(10)
      correct = true
    elseif result == RESULT_TALK02 then
      PlayMotionBlend("HERO_01", "blend02", 3, false, 0)
      SetFace("HERO_01", "E02_M04", 0, 0, FACE_BLENDTIME, 0)
      SetFace("HERO_01", "E02_M04", 0, 1, FACE_BLENDTIME, 60)
      WaitFrame(90)
      Fade_Out(0, FADE_TIME)
      WaitFrame(FADE_TIME)
      correct = true
      goto lbl_1256
    end
  end
  Vista.SetSkip(true)
  MessageTalk("m020_140_050")
  MessageClose()
  WaitFrame(10)
  CUT(4)
  SetEnv_All("c4.0", 0)
  ModelVisible("HERO_01", false, 0, 0)
  SetPosition("HERO_01", -53.846, 0, -1.615, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 7, 0, "LINEAR", 0, 0)
  SetPosition("PIYOMON_01", -54.108, 0, -0.869, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, 236, 0, "LINEAR", 0, 0)
  SetCamera(-55.962, 0.377, -1.617, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-53.731, 0.484, -0.632, "LINEAR", 0, false, 0)
  SetCamera(-55.813, 0.366, -1.934, 0, 30, "LINEAR", 180, true, 0)
  SetCameraTarget(-53.731, 0.484, -0.632, "LINEAR", 180, true, 0)
  PlayMotion("PIYOMON_01", "fe01", 0, false, 0)
  PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
  BlendFaceDigi("PIYOMON_01", -8, 31, 0, "SCURVE", 20, 0)
  Event_StopBGM(1, 0)
  if Debug.IsEventView() then
  else
    Sound.StopBGM(1)
  end
  MessageTalk("m020_140_060")
  MessageClose()
  WaitFrame(10)
  Event_PlaySE(403087, 100, false, 0, 0)
  PlayMotion("PIYOMON_01", "fe02", 0, false, 0)
  SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
  BlendFaceDigi("PIYOMON_01", 0, 0, 0, "SCURVE", 20, 0)
  Event_PlayBGM(708, 0.3, 0)
  WaitFrame(15)
  CUT(5)
  SetEnv_All("c5.0", 0)
  ModelVisible("HERO_01", true, 0, 0)
  BlendFace("HERO_01", 0, 0, 0, true, "SCURVE", 0, 0)
  SetPosition("HERO_01", -54, 0, -0.6, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -90, 0, "LINEAR", 0, 0)
  SetPosition("PIYOMON_01", -54, 0, -0.6, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
  PlayMotion("PIYOMON_01", "r307_in01", 0, false, 0)
  PlayMotion("HERO_01", "r307_in01", 0, false, 0)
  SetFace("PIYOMON_01", "F01", 0, 2, FACE_BLENDTIME, 0)
  SetCamera(-57.251, 1.411, -2.105, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(-54.477, 2.504, -0.065, "LINEAR", 0, false, 0)
  SetCamera(-59.096, 1.122, -3.676, 0, 40, "ACCEL", 98, false, 0)
  SetCameraTarget(-56.326, 3.035, 0.22, "ACCEL", 98, false, 0)
  WaitFrame(98)
  SetCamera(-54.224, 2.049, -0.577, 0, 40, "LINEAR", 80, false, 0)
  SetCameraTarget(-57.962, 1.977, -0.657, "LINEAR", 80, false, 0)
  SetPosition("HERO_01", -58.286, 0, -0.6, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, -90, 0, "LINEAR", 0, 0)
  SetPosition("PIYOMON_01", -58.286, 0, -0.6, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "r307_loop01", 0, true, 0)
  PlayMotion("PIYOMON_01", "r307_loop01", 0, true, 0)
  WaitFrame(80)
  SetPosition("HERO_01", -64.786, 0, -0.6, "LINEAR", 100, 0)
  SetRotation("HERO_01", 0, -90, 0, "LINEAR", 100, 0)
  SetPosition("PIYOMON_01", -64.786, 0, -0.6, "LINEAR", 100, 0)
  SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 100, 0)
  SetCamera(-60.724, 2.049, -0.577, 0, 40, "LINEAR", 100, false, 0)
  SetCameraTarget(-64.462, 1.977, -0.657, "LINEAR", 100, false, 0)
  WaitFrame(80)
  SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
  MessageTalk("m020_140_070")
  MessageClose()
  Event_StopAllSE(0.2, 0)
  WaitFrame(5)
  PlayMotion("HERO_01", "r307_loop02", 10, true, 0)
  PlayMotion("PIYOMON_01", "r307_loop02", 10, true, 0)
  SetPosition("HERO_01", -83.396, -25.67, 5.42, "ACCEL", 130, 0)
  SetRotation("HERO_01", 0, -79, 0, "ACCEL", 130, 0)
  SetPosition("PIYOMON_01", -83.396, -25.67, 5.42, "ACCEL", 130, 0)
  SetRotation("PIYOMON_01", 0, -79, 0, "ACCEL", 130, 0)
  Event_PlaySE(403089, 100, false, 0, 0)
  SetCamera(-83.626, -23.44, 5.882, 0, 40, "ACCEL", 130, false, 5)
  SetCameraTarget(-89.884, -30, 6.482, "ACCEL", 135, false, 5)
  WaitFrame(30)
  SetFace("PIYOMON_01", "F01_M01", 0, 2, FACE_BLENDTIME, 0)
  MessageTalkAuto("m020_140_080", 80, true)
  WaitFrame(90)
  FadeOutWithWaitNotFlgCheck(0, 10)
  WaitFrame(15)
  Event_PlaySE(400008, 100, false, 0, 0)
  CtrVibration(1, 0, 15, 0)
  CtrVibration(0, 0, 0, 15)
  WaitFrame(45)
  Flg.Set("FLAG_MAIN_01_225")
  Event_StopBGM(0.3, 0)
  ::lbl_1256::
  if Debug.IsEventView() then
    Event_StopBGM(0, 0)
  end
  Vista.SetKeepBGM()
  Vista.SetKeepBGMWithMapChange()
  EVENT_END()
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m020_140()
end
