S010_180 = {
  ID = 180,
  STEP_001 = 1,
  STEP_005 = 5,
  STEP_010 = 10,
  STEP_255 = 255
}
local text_file = "s010_180"
local base = "s010_180_"
local tlk = Tlk:new(text_file, 1, true)

function S010_180:Event_010()
  if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    tlk:StartTalkAndCancelDigimonRide()
    HideMinimap(true)
    HideGuide(true)
    tlk:Message(base .. "010")
    tlk:Message(base .. "020")
    tlk:Message(base .. "030")
    local result = tlk:Select(3, base .. "040")
    WaitFrame(15)
    if result == RESULT_TALK00 then
      tlk:Message(base .. "050")
    elseif result == RESULT_TALK01 then
      tlk:Message(base .. "060")
    elseif result == RESULT_TALK02 then
      tlk:Message(base .. "070")
    end
    tlk:Message(base .. "080")
    tlk:Message(base .. "090")
    tlk:EndTalk(true)
    Qst.Sub:Start(self.ID, 1, false)
    HideMinimap(false)
    HideGuide(false)
    Flg.Set("FLAG_SUB_010_180_001")
    Qst.Sub:Set(self.ID, self.STEP_005)
    Field_CancelInvisibleFollowerAllGuest(0, 15, false, false)
    Field_CancelInvisibleFollowerAllPartyMember(0, 15, false, false)
  elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_255) then
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "100")
    tlk:EndTalk()
  end
end

function S010_180:Event_020()
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_255) then
    local asuna_index = GetIndex(NPC, "s010_180_asuna")
    local belstar_index = GetIndex(NPC, "s010_180_belstar")
    Field.ObjectLoadMotion(PLAYER, 1, "fn01_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e005")
    Field.ObjectLoadMotion(PLAYER, 1, "e005_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e010")
    Field.ObjectLoadMotion(PLAYER, 1, "e011_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    Field.ObjectLoadMotion(PLAYER, 1, "e013")
    Field.ObjectLoadMotion(PLAYER, 1, "e015")
    Field.ObjectLoadMotion(PLAYER, 1, "e018")
    Field.ObjectLoadMotion(PLAYER, 1, "e019")
    Field.ObjectLoadMotion(PLAYER, 1, "e033")
    Field.ObjectLoadMotion(PLAYER, 1, "fg07_m01")
    Field.ObjectLoadMotion(NPC, asuna_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, asuna_index, "e002")
    Field.ObjectLoadMotion(NPC, asuna_index, "e004")
    Field.ObjectLoadMotion(NPC, asuna_index, "e005")
    Field.ObjectLoadMotion(NPC, asuna_index, "e006")
    Field.ObjectLoadMotion(NPC, asuna_index, "e008")
    Field.ObjectLoadMotion(NPC, asuna_index, "e012")
    Field.ObjectLoadMotion(NPC, asuna_index, "e013")
    Field.ObjectLoadMotion(NPC, asuna_index, "e018")
    Field.ObjectLoadMotion(NPC, asuna_index, "e020")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn01")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq01")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe04")
    HideMinimap(true)
    HideGuide(true)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Field.SetMobTransparentFrontOfCamera(0, 10, 10, 10)
    Cam.Inst:Set(-33.83, 0, 23.15, -37.02, 1.51, 13.8, default, 0)
    Obj:new(PLAYER, ""):SetPos(-36.94, 0, 24.51, true)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    tlk:StartTalkAndCancelDigimonRide()
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "110")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, asuna_index, "e002", 10, 10)
    tlk:Message(base .. "120")
    Field.ObjectPlayMotion(NPC, asuna_index, "e008", 15, true)
    tlk:Message(base .. "130")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq02", 10, 10)
    tlk:Message(base .. "140")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "150")
    tlk:Message(base .. "160")
    Field.ObjectPlayMotion(NPC, asuna_index, "e005", 15, true)
    tlk:Message(base .. "170")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "180")
    tlk:Message(base .. "190")
    tlk:EndTalk()
    Flg.Set("FLAG_SUB_010_180_002")
    Flg.Set("FLAG_IS_NOT_MAP_NAME_DISP")
    PlaySE(404006, 100)
    MapChange("d", 1102, "start_01", true, FADE_WHITE, FADE_TIME)
  end
end

function S010_180:Event_030()
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_255) then
    local asuna_index = GetIndex(NPC, "s010_180_asuna")
    local belstar_index = GetIndex(NPC, "s010_180_blacktail")
    local belstar_index_2 = GetIndex(NPC, "s010_180_belstar")
    Field.ObjectLoadMotion(NPC, asuna_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, asuna_index, "e002")
    Field.ObjectLoadMotion(NPC, asuna_index, "e004")
    Field.ObjectLoadMotion(NPC, asuna_index, "e005")
    Field.ObjectLoadMotion(NPC, asuna_index, "e006")
    Field.ObjectLoadMotion(NPC, asuna_index, "e007")
    Field.ObjectLoadMotion(NPC, asuna_index, "e008")
    Field.ObjectLoadMotion(NPC, asuna_index, "e012")
    Field.ObjectLoadMotion(NPC, asuna_index, "e013")
    Field.ObjectLoadMotion(NPC, asuna_index, "e018")
    Field.ObjectLoadMotion(NPC, asuna_index, "e020")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn01")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq01")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe04")
    Field.ObjectLoadExpression(NPC, belstar_index, "F01")
    Field.ObjectLoadExpression(NPC, belstar_index, "F02")
    Field.ObjectChangeExpression(NPC, belstar_index, "F02", -1, false, 0)
    Cam.Inst:Set(56.8, -0.71, -43, 47.822, 1.691, -39.33, default, 0)
    HideMinimap(true)
    HideGuide(true)
    FadeAllInWithWait(FADE_WHITE, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "200")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    tlk:Message(base .. "210")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, asuna_index, "e008", 15, true)
    tlk:Message(base .. "220")
    tlk:Message(base .. "230")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    tlk:Message(base .. "240")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, asuna_index, "e005", 15, true)
    tlk:Message(base .. "250")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    Field.ObjectLookAtTheObject(NPC, belstar_index, NPC, asuna_index, 30, 10)
    tlk:Message(base .. "260")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, asuna_index, "e006", 15, true)
    tlk:Message(base .. "270")
    Field.ObjectPlayMotion(NPC, asuna_index, "e005", 15, true)
    tlk:Message(base .. "280")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    tlk:Message(base .. "290")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "300")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, asuna_index, "e002", 10, 10)
    tlk:Message(base .. "310")
    Field.ObjectPlayMotion(NPC, asuna_index, "e005", 15, true)
    tlk:Message(base .. "320")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    tlk:Message(base .. "330")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "340")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    Field.ObjectResetAim(NPC, belstar_index, 15)
    Field.ObjectPlayMotion(NPC, belstar_index, "bn02", 15, true)
    tlk:Message(base .. "350")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, asuna_index, "e006", 15, true)
    tlk:Message(base .. "360")
    Field.ObjectPlayMotion(NPC, asuna_index, "e007", 15, true)
    tlk:Message(base .. "370")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    WaitFrame(30)
    Field.ObjectChangeExpression(NPC, belstar_index, "F01", -1, false, 15)
    tlk:Message(base .. "380")
    tlk:Message(base .. "386")
    tlk:MessageClose()
    Flg.Set("FLAG_SUB_010_180_005")
    PlaySE(404032, 100)
    Fade_OutNoLoadingWithWait(FADE_WHITE, 60)
    Field.ObjectLookAtTheObject(NPC, asuna_index, NPC, belstar_index_2, 10, 10)
    Cam.Inst:Set(57.36, -0.49, -42.83, 48.11, 1.61, -39.68, default, 0)
    FieldObjectSync(NPC, false)
    Field.ObjectPlayMotion(NPC, asuna_index, "e006", 15, true)
    WaitFrame(75)
    FadeAllInWithWait(FADE_WHITE, 60)
    tlk:Message(base .. "390")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "400")
    Field.ObjectChangeExpression(NPC, asuna_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 5)
    tlk:EndTalk()
    Flg.Set("FLAG_SUB_010_180_003")
    Qst.Sub:Set(self.ID, self.STEP_010)
    Flg.Set("FLAG_SKIP_AREACHANGE_MOVE")
    PlaySE(404006, 100)
    MapChange("t", 203, "start_30", true, FADE_WHITE, FADE_TIME)
  end
end

function S010_180:Event_040()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) then
    local asuna_index = GetIndex(NPC, "s010_180_asuna")
    local belstar_index = GetIndex(NPC, "s010_180_belstar")
    Field.ObjectLoadMotion(PLAYER, 1, "fn01_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e005")
    Field.ObjectLoadMotion(PLAYER, 1, "e005_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e010")
    Field.ObjectLoadMotion(PLAYER, 1, "e011_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    Field.ObjectLoadMotion(PLAYER, 1, "e013")
    Field.ObjectLoadMotion(PLAYER, 1, "e015")
    Field.ObjectLoadMotion(PLAYER, 1, "e018")
    Field.ObjectLoadMotion(PLAYER, 1, "e019")
    Field.ObjectLoadMotion(PLAYER, 1, "e020")
    Field.ObjectLoadMotion(PLAYER, 1, "e033")
    Field.ObjectLoadMotion(PLAYER, 1, "fg07_m01")
    Field.ObjectLoadMotion(NPC, asuna_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, asuna_index, "e002")
    Field.ObjectLoadMotion(NPC, asuna_index, "e004")
    Field.ObjectLoadMotion(NPC, asuna_index, "e005")
    Field.ObjectLoadMotion(NPC, asuna_index, "e006")
    Field.ObjectLoadMotion(NPC, asuna_index, "e007")
    Field.ObjectLoadMotion(NPC, asuna_index, "e008")
    Field.ObjectLoadMotion(NPC, asuna_index, "e012")
    Field.ObjectLoadMotion(NPC, asuna_index, "e013")
    Field.ObjectLoadMotion(NPC, asuna_index, "e018")
    Field.ObjectLoadMotion(NPC, asuna_index, "e020")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn01")
    Field.ObjectLoadMotion(NPC, belstar_index, "bn02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq01")
    Field.ObjectLoadMotion(NPC, belstar_index, "fq02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe02")
    Field.ObjectLoadMotion(NPC, belstar_index, "fe04")
    Field.SetMobTransparentFrontOfCamera(0, 10, 10, 10)
    tlk:StartTalkAndCancelDigimonRide()
    WaitFrame(30)
    Obj:new(PLAYER, ""):SetPos(-36.94, 0, 24.51, true)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    Cam.Inst:Set(-33.83, 0, 23.15, -37.02, 1.51, 13.8, default, 0)
    HideMinimap(true)
    HideGuide(true)
    FadeAllInWithWait(FADE_WHITE, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "410")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, asuna_index, "e002", 10, 10)
    tlk:Message(base .. "420")
    ObjectTurnToPlayer(NPC, "s010_180_asuna")
    Cam.Inst:Set(-34.23, -0.1, 22.51, -38.79, 1.63, 13.784, default, 30)
    WaitFrame(30)
    Field.ObjectPlayMotion(NPC, asuna_index, "e008", 15, true)
    tlk:Message(base .. "430")
    local rot = Field.ObjectGetRotationY(FLD_OBJ_PLAYER, 1)
    MovePlayerFrame(rot, 4, 15)
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Obj:new(NPC, "s010_180_belstar"):SetRotationY(170, 0)
    Obj:new(PLAYER, ""):SetPos(-35.62, 0, 17.94, true)
    Cam.Inst:Set(-32.58, 0.29, 11.86, -37.83, 1.32, 20.31, default, 0)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    local result = tlk:Select(3, base .. "440")
    WaitFrame(15)
    if result == RESULT_TALK00 then
      Field.ObjectPlayMotion(NPC, asuna_index, "e020", 15, true)
      tlk:Message(base .. "450")
    elseif result == RESULT_TALK01 then
      Field.ObjectPlayMotion(NPC, asuna_index, "e013", 15, true)
      tlk:Message(base .. "460")
    elseif result == RESULT_TALK02 then
      Field.ObjectPlayMotion(NPC, asuna_index, "e012", 15, true)
      tlk:Message(base .. "470")
    end
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "480")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, asuna_index, "e002", 10, 10)
    tlk:Message(base .. "490")
    tlk:Message(base .. "500")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, belstar_index, "fq01", 10, 10)
    tlk:Message(base .. "510")
    Field.ObjectPlayMotion(NPC, asuna_index, "e004", 15, true)
    tlk:Message(base .. "520")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, asuna_index, "e002", 10, 10)
    tlk:Message(base .. "530")
    Flg.Set("FLAG_SUB_010_180_004")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    FieldObjectSync(NPC, false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Cam.Inst:Clear(30)
    Field.ClearMobTransparentFrontOfCamera(0)
    tlk:EndTalk(true)
    Flg.Clear("FLAG_IS_NOT_MAP_NAME_DISP")
    HideMinimap(false)
    HideGuide(false)
    Qst.Sub:End(self.ID, self.STEP_255)
    Field_CancelInvisibleFollowerAllGuest(0, 15, false, false)
    Field_CancelInvisibleFollowerAllPartyMember(0, 15, false, false)
  end
end
