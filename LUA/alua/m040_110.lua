require("include")

function m040_110()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m040")
  LOAD_VOICE()
  SetEventCutNo(8)
  if Debug.IsEventView() then
    SetTimeZone("Night")
    SetTimeAxis("A2020_dbef_40")
    LoadMap("t0301")
  end
  LoadModel("HERO_01", "Player")
  LoadModel("TAKEMIYA_01", "char_HEROINES_FATHER")
  LoadModel("HEROINE_01", "char_HEROINE")
  LoadSceneViewerResource("c01", "t0301f_pn")
  LoadSceneViewerResource("c02", "t0301f_pn")
  LoadSceneViewerResource("c03", "t0301f_pn")
  LoadSceneViewerResource("c04", "t0301f_pn")
  LoadSceneViewerResource("c05", "t0301f_pn")
  LoadSceneViewerResource("c06", "t0301f_pn")
  LoadSceneViewerResource("c07", "t0301f_pn")
  LoadSceneViewerResource("c07A", "t0301f_pn")
  LoadSceneViewerResource("c07B", "t0301f_pn")
  LoadSceneViewerResource("c07C", "t0301f_pn")
  LoadSceneViewerResource("c08", "t0301f_pn")
  LoadEnvironmentFile("c01", "es_m040_110_c01")
  LoadEnvironmentFile("c02", "es_m040_110_c02")
  LoadEnvironmentFile("c03", "es_m040_110_c03")
  LoadEnvironmentFile("c04", "es_m040_110_c04")
  LoadEnvironmentFile("c05", "es_m040_110_c05")
  LoadEnvironmentFile("c06", "es_m040_110_c06")
  LoadEnvironmentFile("c07", "es_m040_110_c07")
  LoadEnvironmentFile("c07A", "es_m040_110_c07A")
  LoadEnvironmentFile("c07B", "es_m040_110_c07B")
  LoadEnvironmentFile("c07C", "es_m040_110_c07C")
  LoadEnvironmentFile("c08", "es_m040_110_c08")
  WaitVistaLoad()
  SetPosition("HERO_01", -69.567, -0.951, -35.761, "LINEAR", 0, 0)
  SetRotation("HERO_01", -26, 0, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "e017", 0, true, 0)
  SetStartFrame("HERO_01", "e017", 40, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
  SetPosition("TAKEMIYA_01", -69.059, 0.312, -34.894, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, -144.5, 0, "LINEAR", 0, 0)
  PlayMotion("TAKEMIYA_01", "e535", 0, true, 0)
  SetStartFrame("TAKEMIYA_01", "e520", 72, 0)
  BlendEye("TAKEMIYA_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("TAKEMIYA_01", 0, 0, 0, true, "SCURVE", 0, 0)
  SetCamera(-68.883, 1.451, -24.111, 0, 52, "LINEAR", 0, false, 0)
  SetCameraTarget(-63.774, 5.192, -20.045, "LINEAR", 0, false, 0)
  ModelVisible("HERO_01", false, 0, 0)
  Event_StopBGM(0)
  FIELD_SET()
  EVENT_START()
  CUT(2)
  SetEnv_All("c02", 0)
  Fade_In(0, FADE_TIME)
  SetCamera(-74.014, 8.639, -22.386, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-71.331, 4.012, -31.751, "LINEAR", 0, false, 0)
  SetCamera(-74.014, 8.388, -22.386, 0, 30, "LINEAR", 120, false, 0)
  SetCameraTarget(-71.331, 3.762, -31.751, "LINEAR", 120, false, 0)
  SetPosition("HERO_01", -69.529, -0.188, -34.491, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 0, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "fg01_u04", 0, false, 70)
  ModelVisible("HERO_01", true, 0, 70)
  WaitFrame(90)
  Fade_OutNoLoading(0, FADE_TIME)
  WaitFrame(30)
  CUT(3)
  SetEnv_All("c03", 0)
  SetPosition("HERO_01", -68.537, 0.312, -32.729, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 0, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "fn01_01", 0, true, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 30, 0, false, "SCURVE", 0, 0)
  SetPosition("HEROINE_01", -69.134, 0.312, -31.713, "LINEAR", 0, 0)
  SetRotation("HEROINE_01", 0, 109, 0, "LINEAR", 0, 0)
  PlayMotion("HEROINE_01", "fn01_01", 0, true, 0)
  SetBlink("HEROINE_01", 0, 1, 0)
  SetPosition("TAKEMIYA_01", -67.988, 0.312, -31.744, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, -91, 0, "LINEAR", 0, 0)
  BlendFace("TAKEMIYA_01", 0, 0, 0, true, "SCURVE", 0, 0)
  SetCamera(-70.145, 1.681, -30.795, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-68.135, 1.676, -32.212, "LINEAR", 0, false, 0)
  PlayMotion("TAKEMIYA_01", "e005", 2, true, 0)
  SetFace("TAKEMIYA_01", "F03", 2, 2, 0, 0)
  EndMotion("TAKEMIYA_01", 70)
  SetBlink("TAKEMIYA_01", 0, 0.5, 70)
  Fade_In(0, FADE_TIME)
  WaitFrame(30)
  Event_PlayBGM(607, 0, 0)
  MessageTalk("m040_110_010")
  MessageClose()
  WaitFrame(10)
  CUT(4)
  SetEnv_All("c04", 0)
  PlayMotion("TAKEMIYA_01", "fn01_01", 5, true, 0)
  Vista.SetCharCamera("HEROINE_01", "npc001a_cam_B.S_Left", "LINEAR", 0, false, 0)
  BlendEye("HEROINE_01", -21, 0, "SCURVE", 20, 0)
  BlendFace("HEROINE_01", 60, 0, 0, false, "SCURVE", 20, 0)
  SetFace("HEROINE_01", "F11", 0, 1, FACE_BLENDTIME, 0)
  SetBlink("HEROINE_01", 2, 1, 60)
  SetBlink("HEROINE_01", 0, 1, 110)
  MessageTalk("m040_110_020")
  MessageClose()
  WaitFrame(10)
  CUT(5)
  SetEnv_All("c05", 0)
  SetFace("HEROINE_01", "F01", 0, 1, FACE_BLENDTIME, 0)
  BlendEye("HEROINE_01", 0, 0, "LINEAR", 0, 0)
  BlendFace("HEROINE_01", 0, 0, 0, false, "LINEAR", 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 13, 0, false, "SCURVE", 0, 0)
  SetRotation("TAKEMIYA_01", 0, -95, 0, "LINEAR", 0, 0)
  PlayMotion("TAKEMIYA_01", "e002", 0, true, 0)
  SetFace("TAKEMIYA_01", "F15", 0, 1, 0, 0)
  SetCamera(-68.735, 1.858, -31.29, 0, 30, "LINEAR", 0, false, 0)
  SetCameraTarget(-68.027, 1.887, -31.832, "LINEAR", 0, false, 0)
  MessageTalk("m040_110_030")
  MessageClose()
  WaitFrame(10)
  CUT(6)
  SetEnv_All("c06", 0)
  SetCamera(-69.146, 1.711, -29.998, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(-68.582, 1.587, -31.765, "LINEAR", 0, false, 0)
  PlayMotionBlend("HEROINE_01", "blend01", 2, false, 10)
  MessageTalk("m040_110_040")
  MessageClose()
  WaitFrame(10)
  BlendEye("HEROINE_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HEROINE_01", 0, 63, 0, true, "SCURVE", 20, 0)
  BlendFace("TAKEMIYA_01", 0, -44, 0, false, "SCURVE", 30, 10)
  SetFace("HERO_01", "E16_M15", 0, 1, 0, 0)
  BlendFace("HERO_01", 0, -39, 0, false, "SCURVE", 20, 30)
  MessageTalk("m040_110_050")
  MessageClose()
  WaitFrame(10)
  CUT(7)
  SetEnv_All("c07", 0)
  SetRotation("HERO_01", 0, -13, 0, "LINEAR", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
  BlendEye("HEROINE_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HEROINE_01", 0, 0, 0, true, "SCURVE", 0, 0)
  correct = false
  while not Vista.IsSkipping() and not correct do
    SetCamera(-68.662, 1.823, -31.505, 0, 29, "LINEAR", 0, false, 0)
    SetCameraTarget(-68.576, 1.772, -32.703, "LINEAR", 0, false, 0)
    MessageTalkSel(3, "m040_110_060")
    result = Talk.GetResultSelectedNum()
    SetFace("HERO_01", "F01", 0, 1, 3, 0)
    SetMouth("HERO_01", 0, 6, 0)
    SetMouth("HERO_01", 1, 2, 70)
    PlayMotion("HERO_01", "e002", 5, false, 0)
    PlayMotion("HERO_01", "fn01_01", 5, true, 136)
    WaitFrame(60)
    if result == RESULT_TALK00 then
      CUT("7A")
      SetEnv_All("c07A", 0)
      SetPosition("HEROINE_01", -69.134, 0.312, -31.713, "LINEAR", 0, 0)
      SetRotation("HEROINE_01", 0, 156, 0, "LINEAR", 0, 0)
      SetRotation("HERO_01", 0, -13, 0, "LINEAR", 0, 0)
      BlendFace("HERO_01", 0, -31, 0, false, "SCURVE", 0, 0)
      SetCamera(-67.848, 1.628, -32.871, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(-69.154, 1.706, -32.144, "LINEAR", 0, false, 0)
      WaitFrame(5)
      PlayMotion("HEROINE_01", "e033", 0, true, 0)
      SetFace("HEROINE_01", "F16", 0, 1, 3, 0)
      MessageTalk("m040_110_070")
      MessageClose()
      WaitFrame(10)
      EndMotion("HEROINE_01", 0)
      PlayMotionBlend("HEROINE_01", "blend02", 0, false, 10)
      SetFace("HEROINE_01", "F11", 2, 1, 3, 0)
      SetBlink("HEROINE_01", 0, 0.5, 30)
      MessageTalk("m040_110_080")
      MessageClose()
      WaitFrame(10)
      correct = true
    elseif result == RESULT_TALK01 then
      CUT("7B")
      SetEnv_All("c07B", 0)
      SetPosition("HEROINE_01", -69.134, 0.312, -31.713, "LINEAR", 0, 0)
      SetRotation("HEROINE_01", 0, 156, 0, "LINEAR", 0, 0)
      SetRotation("HERO_01", 0, -13, 0, "LINEAR", 0, 0)
      BlendFace("HERO_01", 0, -31, 0, false, "SCURVE", 0, 0)
      SetCamera(-67.848, 1.628, -32.871, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(-69.154, 1.706, -32.144, "LINEAR", 0, false, 0)
      WaitFrame(5)
      PlayMotionBlend("HEROINE_01", "blend01", 2, false, 10)
      PlayMotion("HEROINE_01", "e022", 0, true, 80)
      SetFace("HEROINE_01", "E01_M02", 0, 1, 3, 80)
      MessageTalk("m040_110_090")
      MessageClose()
      WaitFrame(10)
      correct = true
    elseif result == RESULT_TALK02 then
      CUT("7C")
      SetEnv_All("c07C", 0)
      SetPosition("HEROINE_01", -69.134, 0.312, -31.713, "LINEAR", 0, 0)
      SetRotation("HEROINE_01", 0, 156, 0, "LINEAR", 0, 0)
      SetRotation("HERO_01", 0, -13, 0, "LINEAR", 0, 0)
      BlendFace("HERO_01", 0, -31, 0, false, "SCURVE", 0, 0)
      SetCamera(-67.848, 1.628, -32.871, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(-69.154, 1.706, -32.144, "LINEAR", 0, false, 0)
      WaitFrame(5)
      PlayMotion("HEROINE_01", "e033", 0, true, 0)
      SetFace("HEROINE_01", "F11", 0, 1, 3, 0)
      MessageTalk("m040_110_100")
      MessageClose()
      WaitFrame(10)
      EndMotion("HEROINE_01", 0)
      PlayMotionBlend("HEROINE_01", "blend02", 0, false, 10)
      SetFace("HEROINE_01", "F11", 2, 1, 3, 0)
      SetBlink("HEROINE_01", 0, 0.5, 30)
      MessageTalk("m040_110_110")
      MessageClose()
      WaitFrame(10)
      correct = true
    end
  end
  WaitFrame(15)
  CUT(8)
  SetEnv_All("c08", 0)
  SetPosition("HERO_01", -68.447, 0.312, -32.639, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 0, 0, "LINEAR", 0, 0)
  SetFace("HERO_01", "E16_M15", 0, 1, 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, -30, 0, true, "SCURVE", 0, 0)
  BlendEye("HERO_01", 0, 11, "SCURVE", 25, 26)
  BlendFace("HERO_01", 0, 16, 0, true, "SCURVE", 25, 26)
  SetFace("HERO_01", "F15", 0, 1, 3, 30)
  SetPosition("TAKEMIYA_01", -68.178, 0.312, -31.864, "LINEAR", 0, 0)
  SetRotation("TAKEMIYA_01", 0, -111, 0, "LINEAR", 0, 0)
  PlayMotion("TAKEMIYA_01", "e002", 0, true, 0)
  BlendEye("TAKEMIYA_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("TAKEMIYA_01", 0, 27.01, 0, false, "SCURVE", 0, 0)
  PlayMotion("HEROINE_01", "fn01_01", 0, true, 0)
  SetFace("HEROINE_01", "F01", 0, 1, 3, 0)
  BlendEye("HEROINE_01", 0, -9, "SCURVE", 20, 10)
  BlendFace("HEROINE_01", -24, -72, 0, true, "SCURVE", 20, 10)
  SetCamera(-69.394, 1.481, -30.62, 0, 25, "LINEAR", 0, false, 0)
  SetCameraTarget(-68.487, 1.768, -32.018, "LINEAR", 0, false, 0)
  MessageTalk("m040_110_120")
  MessageClose()
  WaitFrame(10)
  PlayMotion("TAKEMIYA_01", "e012", 5, true, 0)
  BlendEye("TAKEMIYA_01", 0, -54, "SCURVE", 30, 70)
  BlendFace("TAKEMIYA_01", 0, -32.99, 0, false, "SCURVE", 30, 70)
  MessageTalk("m040_110_130")
  MessageClose()
  WaitFrame(10)
  Event_StopBGM(1, 0)
  Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
  WaitFrame(30)
  if Debug.IsEventView() then
    Event_StopBGM(0, 0)
  end
  Vista.SetKeepBGM()
  EVENT_END()
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m040_110()
end
