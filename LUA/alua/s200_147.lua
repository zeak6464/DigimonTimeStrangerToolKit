S200_147 = {
  ID = 147,
  STEP_001 = 1,
  STEP_005 = 5,
  STEP_010 = 10,
  STEP_015 = 15,
  STEP_020 = 20,
  STEP_255 = 255
}
local base = "s200_147_"
local text_file = "s200_147"
local tlk = Tlk:new(text_file, 1, true)

function S200_147:Event_001()
  local tlk = Tlk:new(text_file, 1, true)
  if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "710")
    local result = tlk:Select(2, base .. "720")
    if result == RESULT_TALK00 then
      tlk:EndTalk(true)
      Obj:new(NPC, "npc_0500"):Invisible(10)
      Common.ProhibitSave()
      require("S200_147")
      S200_147:Event_010()
    else
      tlk:EndTalk()
    end
  end
end

function S200_147:Event_010()
  if not Qst.Sub:IsCompleted(self.ID) then
    local hiroko_index = GetIndex(NPC, "S200_147_hiroko_01")
    local h_fn01_01 = Motion.Object:new(NPC, "S200_147_hiroko_01", "fn01_01")
    local h_e002 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e002")
    local h_e004 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e004")
    local h_e008 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e008")
    local h_e012 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e012")
    Field.ObjectLoadExpression(NPC, hiroko_index, "F01")
    local p_e002 = Motion.Object:new(PLAYER, "", "e002")
    local p_e004 = Motion.Object:new(PLAYER, "", "e004")
    local p_e012 = Motion.Object:new(PLAYER, "", "e012")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    Field.ObjectLoadMotionBlend(PLAYER, 1, "blend01")
    local tlk = Tlk:new(text_file, 1, true)
    Flg.Set("FLAG_SUB_200_147_009")
    Fade_OutNoLoadingWithWait(FADE_BLACK, 30)
    Cam.Inst:Set(-2.56, -0.15, 30.91, 1.143, 1.441, 40.07, default, 0)
    FieldObjectSync(FOR_ALL, false)
    HideMinimap(true)
    HideGuide(true)
    Field_InvisibleFollowerAllGuest(0, 0, false)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Obj:new(PLAYER, ""):SetPos(-0.237, 0, 38.163)
    Obj:new(PLAYER, ""):SetRotationY(15, 0)
    p_fn01_01:Play(15, true)
    WaitFrame(30)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, hiroko_index, 0)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, PLAYER, 1, 0)
    tlk:StartTalkAndCancelDigimonRide()
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
      h_e002:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "010")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      local result = tlk:Select(3, base .. "020")
      if result == RESULT_TALK00 then
        WaitFrame(15)
        h_e008:PlayWithStartMoveMotion(10, 10)
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
        tlk:Message(base .. "030")
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      elseif result == RESULT_TALK01 then
        WaitFrame(15)
        h_e008:PlayWithStartMoveMotion(10, 10)
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
        tlk:Message(base .. "040")
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      elseif result == RESULT_TALK02 then
        WaitFrame(15)
        h_e008:PlayWithStartMoveMotion(10, 10)
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
        tlk:Message(base .. "050")
        Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      end
    end
    if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_010) then
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      h_e002:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "060")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      Field.ObjectPlayMotionBlend(PLAYER, 1, "blend01", 10, false)
      WaitFrame(30)
      tlk:EndTalk(true)
      Qst.Sub:Start(self.ID, 1, false)
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      Qst.Sub:Set(self.ID, self.STEP_005)
      Qst.Sub:Set(self.ID, self.STEP_010)
      Flg.Set("FLAG_SUB_200_147_001")
      FieldObjectSync(FOR_ALL, false)
      require("S200_147")
      S200_147:Event_020()
    elseif Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_020) then
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      h_e002:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "255")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:MessageClose()
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      tlk:EndTalk()
      Cam.Inst:Clear(0)
      WaitFrame(30)
      HideMinimap(false)
      HideGuide(false)
      FieldObjectSync(FOR_ALL, false)
      FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    end
  end
end

function S200_147:Event_020()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_015) then
    local tlk = Tlk:new(text_file, 1, true)
    local npc_index = GetIndex(NPC, "S200_147_npc_01")
    local hiroko_index = GetIndex(NPC, "S200_147_hiroko_01")
    local h_fn01_01 = Motion.Object:new(NPC, "S200_147_hiroko_01", "fn01_01")
    local h_e002 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e002")
    local h_e004 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e004")
    local h_e005 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e005")
    local h_e008 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e008")
    local h_e012 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e012")
    local n_fn01_01 = Motion.Object:new(NPC, "S200_147_npc_01", "fn01_01")
    local n_e002 = Motion.Object:new(NPC, "S200_147_npc_01", "e002")
    local n_e004 = Motion.Object:new(NPC, "S200_147_npc_01", "e004")
    local n_e005 = Motion.Object:new(NPC, "S200_147_npc_01", "e005")
    local n_e007 = Motion.Object:new(NPC, "S200_147_npc_01", "e005")
    local n_e008 = Motion.Object:new(NPC, "S200_147_npc_01", "e008")
    local n_e012 = Motion.Object:new(NPC, "S200_147_npc_01", "e012")
    local p_e002 = Motion.Object:new(PLAYER, "", "e002")
    local p_e004 = Motion.Object:new(PLAYER, "", "e004")
    local p_e012 = Motion.Object:new(PLAYER, "", "e012")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    Field.ObjectResetAim(NPC, hiroko_index, 10)
    Field.ObjectResetAim(PLAYER, 1, 10)
    Obj:new(NPC, "npc_0316"):Invisible(0)
    tlk:StartTalkAndCancelDigimonRide()
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    n_e005:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "100")
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, npc_index, 30)
    WaitFrame(1)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, npc_index, 30)
    h_e002:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "110")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    n_e012:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "120")
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    local result = tlk:Select(3, base .. "130")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      n_e005:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "140")
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      n_e005:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "150")
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    else
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      n_e005:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "160")
      Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    end
    h_e002:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "170")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    n_e008:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "180")
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectResetAim(NPC, hiroko_index, 10)
    WaitFrame(1)
    Field.ObjectResetAim(PLAYER, 1, 10)
    h_e008:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "190")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    local result = tlk:Select(3, base .. "200")
    if result == RESULT_TALK00 then
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      h_e012:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "210")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    elseif result == RESULT_TALK01 then
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      h_e012:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "220")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    else
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      h_e005:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "230")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    end
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, npc_index, 30)
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    h_e002:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "240")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    n_e005:PlayWithStartMoveMotion(10, 10)
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "250")
    Field.ObjectChangeExpression(NPC, npc_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:MessageClose()
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    SetEnableGimmickCheck("map_0001", false)
    SetEnableGimmickCheck("map_0002", false)
    SetEnableGimmickCheck("map_0003", false)
    tlk:EndTalk()
    Field.ObjectResetAim(NPC, hiroko_index, 10)
    Cam.Inst:Clear(0)
    HideMinimap(false)
    HideGuide(false)
    FieldObjectSync(FOR_ALL, false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_015)
  end
end

function S200_147:Event_031()
  if Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_020) then
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "255")
    Field.MovePlayerToRelativePosFrame(3, 0, 30)
    WaitFrame(30)
    tlk:EndTalk()
  end
end

function S200_147:Event_032()
  if Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_020) then
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "255")
    Field.MovePlayerToRelativePosFrame(-3, 0, 30)
    WaitFrame(30)
    tlk:EndTalk()
  end
end

function S200_147:Event_030()
  if Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_020) then
    local p_e514 = Motion.Object:new(PLAYER, "", "e514")
    local p_e006 = Motion.Object:new(PLAYER, "", "e006")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    local hiroko_index = GetIndex(NPC, "s200_147_hiroko_02")
    local h_e006 = Motion.Object:new(NPC, "s200_147_hiroko_02", "e006")
    local h_e018 = Motion.Object:new(NPC, "s200_147_hiroko_02", "e018")
    local h_fn01_01 = Motion.Object:new(NPC, "s200_147_hiroko_02", "fn01_01")
    Field.ObjectLoadExpression(NPC, hiroko_index, "F01")
    local tlk = Tlk:new(text_file, 1, true)
    HideMinimap(true)
    HideGuide(true)
    Field_InvisibleFollowerAllGuest(0, 10, ture)
    Field_InvisibleFollowerAllPartyMember(0, 10, ture)
    local slot1 = PlaySE(403003, 100)
    Common.SetVibration(0.6, 0, 0.4)
    Quake.Start(0, 0.5, 15)
    p_e514:Play2Wait(15, ture)
    WaitFrame(15)
    StopSE(slot1, 15)
    Flg.Set("FLAG_SUB_200_147_007")
    Flg.Set("FLAG_SUB_200_147_008")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Field_InvisibleMob(FOR_ALL, INVISIBLE_KEY_EVENT, 0, false)
    FieldObjectSync(FOR_ALL, false)
    Cam.Inst:Set(-3.361, 0.8499, 12.39, 1.0492, 1.5869, 21.335, default, 0)
    p_fn01_01:Play(15, ture)
    Obj:new(PLAYER, ""):SetPos(-0.75, 0, 19.543)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    h_e006:Play(10, true)
    tlk:Message(base .. "260")
    h_e018:Play(10, true)
    p_e006:Play(10, true)
    tlk:Message(base .. "270")
    PlaySE(200006, 100)
    tlk:EndTalk(true)
    Flg.Set("FLAG_SUB_200_147_002")
    Flg.Set("FLAG_IS_NOT_MAP_NAME_DISP")
    MapChange("h", 201, "start_20", true, FADE_WHITE, 60)
  end
end

function S200_147:Event_040()
  if Qst.Sub:Check(self.ID, self.STEP_015, self.STEP_020) then
    local hiroko_index = GetIndex(NPC, "S200_147_hiroko_01")
    local digimon_index = GetIndex(NPC, "S200_147_digi_01")
    local cosplayer_index = GetIndex(NPC, "S200_147_npc_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    Field.ObjectLoadMotion(PLAYER, 1, "e013")
    Field.ObjectLoadMotion(PLAYER, 1, "e015")
    Field.ObjectLoadMotion(PLAYER, 1, "e018")
    Field.ObjectLoadMotion(PLAYER, 1, "e019")
    Field.ObjectLoadMotion(PLAYER, 1, "e201")
    Field.ObjectLoadMotion(NPC, hiroko_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e002")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e003")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e004")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e010")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e006")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e008")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e012")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e002")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e004")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e006")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e008")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e010")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e011")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e012")
    Field.ObjectLoadMotion(NPC, digimon_index, "bn01")
    Field.ObjectLoadMotion(NPC, digimon_index, "fe02")
    Field.ObjectLoadMotion(NPC, digimon_index, "fe04")
    Field.ObjectLoadMotion(NPC, digimon_index, "fq01")
    Field.ObjectLoadMotion(NPC, digimon_index, "fq02")
    local tlk = Tlk:new(text_file, 1, true)
    Cam.Inst:Set(-21.664, -6, -19.607, -11.887, -3.957, -20.088, default, 0)
    Obj:new(PLAYER, ""):SetPos(-15.444, -6, -18.772)
    Field.ObjectSetRotationY(PLAYER, 1, -108.894, 0)
    tlk:StartTalkAndCancelDigimonRide()
    HideMinimap(true)
    HideGuide(true)
    WaitFrame(15)
    FadeAllInWithWait(FADE_WHITE, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, hiroko_index, "e003", 10, 10)
    Field.ObjectPlayMotionWithStartMoveMotion(PLAYER, 1, "e201", 10, 10)
    tlk:Message(base .. "280")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, cosplayer_index, "e006", 15, true)
    tlk:Message(base .. "290")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, cosplayer_index, 10)
    WaitFrame(1)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, cosplayer_index, 10)
    local result = tlk:Select(3, base .. "300")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      Field.ObjectPlayMotion(NPC, hiroko_index, "e012", 15, true)
      tlk:Message(base .. "310")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, hiroko_index, "e002", 10, 10)
      tlk:Message(base .. "320")
    elseif result == RESULT_TALK02 then
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, hiroko_index, "e002", 10, 10)
      tlk:Message(base .. "330")
    end
    Field.ObjectPlayMotion(NPC, cosplayer_index, "e011", 15, true)
    tlk:Message(base .. "340")
    Field.ObjectPlayMotion(NPC, hiroko_index, "e008", 15, true)
    tlk:Message(base .. "350")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Flg.Set("FLAG_SUB_200_147_003")
    FieldObjectSync(FOR_ALL, false)
    Field.ObjectPlayMotion(NPC, hiroko_index, "e006", 15, true)
    Obj:new(PLAYER, ""):SetRotationY(-60, 0)
    Obj:new(NPC, "S200_147_hiroko_01"):SetRotationY(-60, 0)
    Obj:new(NPC, "S200_147_npc_01"):SetRotationY(-30, 0)
    Field.ObjectResetAim(PLAYER, 1, 10)
    Field.ObjectResetAim(NPC, hiroko_index, 10)
    WaitFrame(15)
    Cam.Inst:Set(-22.603, -5.7, -23.22, -13.72, -4.545, -18.775, default, 0)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, digimon_index, 0)
    WaitFrame(1)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, digimon_index, 0)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fe02", 10, 10)
    tlk:Message(base .. "360")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fq02", 10, 10)
    tlk:Message(base .. "370")
    local result = tlk:Select(3, base .. "380")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fq02", 10, 10)
      tlk:Message(base .. "390")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fe04", 10, 10)
      tlk:Message(base .. "400")
    else
      WaitFrame(15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fe04", 10, 10)
      tlk:Message(base .. "410")
    end
    tlk:Message(base .. "420")
    tlk:MessageClose()
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, digimon_index, "fe02", 10, 10)
    Field.ObjectPlayMotion(PLAYER, 1, "e018", 15, true)
    WaitFrame(30)
    Qst.Sub:Set(self.ID, self.STEP_020)
    tlk:EndTalk(true)
    EncountFromField_PlaySound(22001470, 20272, false)
  end
end

function S200_147:Event_045()
  if Qst.Sub:Check(self.ID, self.STEP_020, self.STEP_025) then
    local hiroko_index = GetIndex(NPC, "S200_147_hiroko_01")
    local digimon_index = GetIndex(NPC, "S200_147_digi_01")
    local cosplayer_index = GetIndex(NPC, "S200_147_npc_01")
    Field.ObjectLoadMotion(PLAYER, 1, "fn01_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e006")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    Field.ObjectLoadMotion(PLAYER, 1, "e013")
    Field.ObjectLoadMotion(PLAYER, 1, "e015")
    Field.ObjectLoadMotion(PLAYER, 1, "e018")
    Field.ObjectLoadMotion(PLAYER, 1, "e019")
    Field.ObjectLoadMotion(NPC, hiroko_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e002")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e003")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e004")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e010")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e006")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e008")
    Field.ObjectLoadMotion(NPC, hiroko_index, "e012")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "fn01_01")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e002")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e004")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e006")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e008")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e010")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e011")
    Field.ObjectLoadMotion(NPC, cosplayer_index, "e012")
    HideMinimap(true)
    HideGuide(true)
    Obj:new(PLAYER, ""):SetRotationY(-90, 0)
    Obj:new(NPC, "S200_147_hiroko_01"):SetRotationY(-90, 0)
    Obj:new(NPC, "S200_147_npc_01"):SetRotationY(90, 0)
    local tlk = Tlk:new(text_file, 1, true)
    Cam.Inst:Set(-21.664, -6, -19.607, -11.887, -3.957, -20.088, default, 0)
    FieldObjectSync(FOR_ALL, false)
    Field.ObjectPlayMotion(PLAYER, 1, "fn01_01", 15, true)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, cosplayer_index, 10)
    WaitFrame(1)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, cosplayer_index, 10)
    tlk:StartTalkAndCancelDigimonRide()
    WaitFrame(15)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    Field.ObjectPlayMotion(NPC, hiroko_index, "e008", 15, true)
    tlk:Message(base .. "430")
    tlk:Message(base .. "440")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotion(NPC, cosplayer_index, "e002", 15, true)
    tlk:Message(base .. "450")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    local result = tlk:Select(3, base .. "460")
    Field.ObjectPlayMotion(NPC, hiroko_index, "e012", 15, true)
    if result == RESULT_TALK00 then
      WaitFrame(15)
      tlk:Message(base .. "470")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      tlk:Message(base .. "480")
    elseif result == RESULT_TALK02 then
      WaitFrame(15)
      tlk:Message(base .. "490")
    end
    tlk:Message(base .. "500")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, hiroko_index, "e002", 10, 10)
    tlk:Message(base .. "510")
    tlk:MessageClose()
    Quake.Start(0, 0.5, 15)
    local slot1 = PlaySE(403003, 100)
    RegularQuake_Start(0.02, 0, 60, 120)
    Field.ObjectPlayMotion(NPC, hiroko_index, "e006", 15, true)
    Field.ObjectPlayMotion(NPC, cosplayer_index, "e006", 15, true)
    Field.ObjectPlayMotion(PLAYER, 1, "e006", 15, true)
    WaitFrame(30)
    StopSE(slot1, 15)
    tlk:Message(base .. "520")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F03", EYES_BLINK_TYPE_CLOSE, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "530")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F03", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:MessageClose()
    RegularQuake_Stop()
    PlaySE(200006, 100)
    Flg.Set("FLAG_SUB_200_147_005")
    Flg.Set("FLAG_SKIP_AREACHANGE_MOVE")
    tlk:EndTalk(true)
    MapChange("t", 302, "start_00", true, FADE_WHITE, FADE_TIME)
  end
end

function S200_147:Event_050()
  if Qst.Sub:Check(self.ID, self.STEP_020, self.STEP_255) then
    local tlk = Tlk:new(text_file, 1, true)
    local hiroko_index = GetIndex(NPC, "S200_147_hiroko_01")
    local cosplayer_index = GetIndex(NPC, "S200_147_npc_02")
    local friend_index = GetIndex(NPC, "S200_147_npc_01")
    local f_e017 = Motion.Object:new(NPC, "S200_147_npc_01", "e017")
    local h_fn01_01 = Motion.Object:new(NPC, "S200_147_hiroko_01", "fn01_01")
    local h_e002 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e002")
    local h_e004 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e004")
    local h_e008 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e008")
    local h_e012 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e012")
    local h_e020 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e020")
    local h_e206 = Motion.Object:new(NPC, "S200_147_hiroko_01", "e206")
    local f_fn01_01 = Motion.Object:new(NPC, "S200_147_npc_01", "fn01_01")
    local f_e002 = Motion.Object:new(NPC, "S200_147_npc_01", "e002")
    local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
    Cam.Inst:Set(-4.958, -2.3999, 33.31, 1.9412, 2.225, 38.884, default, 0)
    HideMinimap(true)
    HideGuide(true)
    Field_InvisibleFollowerAllGuest(0, 0, false)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Obj:new(PLAYER, ""):SetPos(-0.237, 0, 38.163)
    Obj:new(PLAYER, ""):SetRotationY(-15, 0)
    Obj:new(NPC, "S200_147_npc_01"):SetRotationY(-110, 0)
    p_fn01_01:Play(15, true)
    WaitFrame(30)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, cosplayer_index, 0)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, NPC, cosplayer_index, 0)
    Field.ObjectLookAtTheObject(NPC, friend_index, NPC, cosplayer_index, 0)
    FadeAllInWithWait(FADE_WHITE, FADE_TIME)
    tlk:StartTalkAndCancelDigimonRide()
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "550")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectChangeExpression(NPC, friend_index, "F02", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "560")
    Field.ObjectChangeExpression(NPC, friend_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectChangeExpression(NPC, hiroko_index, "F02", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "570")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    local result = tlk:Select(3, base .. "580")
    WaitFrame(15)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, PLAYER, 1, 30)
    if result == RESULT_TALK00 then
      h_e020:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F02", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "590")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    elseif result == RESULT_TALK01 then
      h_e002:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F03", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "600")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    else
      h_e002:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_CLOSE, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "610")
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    end
    Field.ObjectLookAtTheObject(NPC, friend_index, PLAYER, 1, 30)
    Field.ObjectChangeExpression(NPC, friend_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    f_e002:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "620")
    Field.ObjectChangeExpression(NPC, friend_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "630")
    Field.ObjectChangeExpression(NPC, cosplayer_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectLookAtTheObject(NPC, friend_index, NPC, cosplayer_index, 30)
    f_e017:Play(10, true)
    Field.ObjectChangeExpression(NPC, friend_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "640")
    Field.ObjectChangeExpression(NPC, friend_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:MessageClose()
    Flg.Set("FLAG_SUB_200_147_006")
    FadeOutWithWait(0, 15)
    FieldObjectSync(FOR_ALL, false)
    WaitFrame(30)
    Cam.Inst:Set(-1.671, 0.15, 29.38, 0.372, 1.514, 39.072, default, 0)
    Field.ObjectLookAtTheObject(PLAYER, 1, NPC, hiroko_index, 0)
    Field.ObjectLookAtTheObject(NPC, hiroko_index, PLAYER, 1, 0)
    FadeInWithWait(0, 15)
    local result = tlk:Select(3, base .. "650")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      h_e008:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "660")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      h_e008:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F03", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "670")
    elseif result == RESULT_TALK02 then
      WaitFrame(15)
      h_e002:PlayWithStartMoveMotion(10, 10)
      Field.ObjectChangeExpression(NPC, hiroko_index, "F02", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "680")
    end
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, true, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "690")
    h_e206:Play(10, true)
    tlk:Message(base .. "700")
    Field.ObjectChangeExpression(NPC, hiroko_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:MessageClose()
    Flg.Set("FLAG_IS_CLEAR_S200_147")
    Fade_OutNoLoadingWithWait(FADE_BLACK, 30)
    Obj:new(NPC, "npc_0500"):CancelInvisible(0)
    FieldObjectSync(FOR_ALL, false)
    tlk:EndTalk()
    Cam.Inst:Clear(0)
    Flg.Clear("FLAG_IS_NOT_MAP_NAME_DISP")
    SetEnableGimmickCheck("map_0001", true)
    SetEnableGimmickCheck("map_0002", true)
    SetEnableGimmickCheck("map_0003", true)
    Common.CancelProhibitSave()
    HideMinimap(false)
    HideGuide(false)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_255)
  end
end
