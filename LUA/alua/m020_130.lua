require("include")

function m020_130()
  Fade_Out(0, 0)
  EVENT_BEGIN()
  Talk.Load("m020")
  SetEventCutNo(9)
  if Debug.IsEventView() then
    SetTimeZone("Evening")
    SetTimeAxis("X2028_daft_20")
    LoadMap("d1403")
  end
  LoadModel("HERO_01", "Player")
  LoadModel("PIYOMON_01", "char_PIYOMON")
  LoadSceneViewerResource("c1.0", "d1403f_ce")
  LoadSceneViewerResource("c2.0", "d1403f_ce")
  LoadSceneViewerResource("c2.0_B1", "d1403f_ce")
  LoadSceneViewerResource("c2.0_C1", "d1403f_ce")
  LoadSceneViewerResource("c3.0", "d1403f_ce")
  LoadSceneViewerResource("c4.0", "d1403f_ce")
  LoadSceneViewerResource("c4.0_A1", "d1403f_ce")
  LoadSceneViewerResource("c4.0_B1", "d1403f_ce")
  LoadSceneViewerResource("c4.0_C1", "d1403f_ce")
  LoadEnvironmentFile("c1.0", "es_m020_130_c1.0")
  LoadEnvironmentFile("c2.0", "es_m020_130_c2.0")
  LoadEnvironmentFile("c2.0_B1", "es_m020_130_c2.0_B1")
  LoadEnvironmentFile("c2.0_C1", "es_m020_130_c2.0_C1")
  LoadEnvironmentFile("c3.0", "es_m020_130_c3.0")
  LoadEnvironmentFile("c4.0", "es_m020_130_c4.0")
  LoadEnvironmentFile("c4.0_A1", "es_m020_130_c4.0_A1")
  LoadEnvironmentFile("c4.0_B1", "es_m020_130_c4.0_B1")
  LoadEnvironmentFile("c4.0_C1", "es_m020_130_c4.0_C1")
  WaitVistaLoad()
  SetPosition("HERO_01", 26.809, 0, -9.7, "LINEAR", 0, 0)
  SetRotation("HERO_01", 0, 90, 0, "LINEAR", 0, 0)
  SetPosition("PIYOMON_01", 28.516, 0, -9.74, "LINEAR", 0, 0)
  SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
  PlayMotion("HERO_01", "e017", 0, true, 0)
  SetStartFrame("HERO_01", "e017", 57, 0)
  SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
  PlayMotion("PIYOMON_01", "f000", 0, true, 0)
  SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
  BlendEye("HERO_01", 0, 0, "SCURVE", 0, 0)
  BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
  SetCamera(26.888, 1.52, -9.262, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(27.583, 1.045, -9.681, "LINEAR", 0, false, 0)
  Event_StopBGM(3)
  FIELD_SET()
  EVENT_START()
  NpcInvisible(FOR_ALL)
  CUT("1.0")
  SetEnv_All("c1.0", 0)
  Fade_In(0, FADE_TIME)
  WaitFrame(FADE_TIME)
  MessageTalk("m020_130_010")
  MessageClose()
  WaitFrame(30)
  CUT("2.0")
  SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
  BlendFaceDigi("PIYOMON_01", -14, 0, 0, "LINEAR", 0, 20)
  Event_PlayBGM(907, 3, 0)
  correct = false
  while not Vista.IsSkipping() and not correct do
    PlayMotion("PIYOMON_01", "bn01", 0, true, 0)
    SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
    SetEnv_All("c2.0", 0)
    SetCamera(29.947, 0.458, -7.744, 0, 20, "LINEAR", 0, false, 0)
    SetCameraTarget(27.107, 0.922, -10.337, "LINEAR", 0, false, 0)
    ModelVisible("HERO_01", true, 0, 0)
    MessageTalkSel(3, "m020_130_020")
    result = Talk.GetResultSelectedNum()
    if result == RESULT_TALK00 then
      SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
      SetMouth("HERO_01", 0, 0, 0)
      SetMouth("HERO_01", 1, 0, 60)
      PlayMotionForce("HERO_01", "e034", 5, true, 0)
      WaitFrame(90)
      SetPosition("PIYOMON_01", 28.516, 0, -9.74, "LINEAR", 0, 0)
      SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
      WaitFrame(1)
      correct = true
    elseif result == RESULT_TALK01 then
      SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
      BlendFace("HERO_01", 0, 0, -61, false, "SCURVE", 30, 0)
      BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 30, 40)
      SetMouth("HERO_01", 0, 6, 0)
      SetMouth("HERO_01", 1, 0, 30)
      WaitFrame(40)
      SetPosition("PIYOMON_01", 28.516, 0, -9.74, "LINEAR", 0, 0)
      SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
      CUT("2.0_B1")
      SetEnv_All("c2.0_B1", 0)
      SetCamera(26.911, 1.502, -8.876, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(28.22, 0.663, -9.627, "LINEAR", 0, false, 0)
      ModelVisible("HERO_01", false, 0, 0)
      PlayMotion("PIYOMON_01", "fe02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 60)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      MessageTalk("m020_130_030")
      MessageTalk("m020_130_040")
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      MessageTalk("m020_130_050")
      MessageClose()
      SetMouth("PIYOMON_01", 1, 0, 0)
      WaitFrame(10)
    elseif result == RESULT_TALK02 then
      PlayMotionBlend("HERO_01", "blend01", 3, false, 0)
      SetFace("HERO_01", "E03_M04", 0, 1, 0, 0)
      PlayMotionForce("HERO_01", "e034", 5, true, 0)
      SetMouth("HERO_01", 0, 6, 0)
      SetMouth("HERO_01", 1, 0, 60)
      WaitFrame(90)
      SetPosition("PIYOMON_01", 28.516, 0, -9.74, "LINEAR", 0, 0)
      SetRotation("PIYOMON_01", 0, -90, 0, "LINEAR", 0, 0)
      CUT("2.0_C1")
      SetEnv_All("c2.0_C1", 0)
      SetCamera(26.911, 1.502, -8.876, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(28.22, 0.663, -9.627, "LINEAR", 0, false, 0)
      ModelVisible("HERO_01", false, 0, 0)
      PlayMotion("PIYOMON_01", "bn01", 5, true, 0)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      MessageTalk("m020_130_060")
      MessageTalk("m020_130_070")
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      MessageTalk("m020_130_080")
      MessageClose()
      WaitFrame(10)
    end
  end
  CUT("3.0")
  PlayMotion("PIYOMON_01", "bn01", 5, true, 0)
  SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
  BlendFaceDigi("PIYOMON_01", 55, 0, 0, "SCURVE", 0, 0)
  BlendFaceDigi("PIYOMON_01", 0, 0, 0, "SCURVE", 60, 60)
  SetEnv_All("c3.0", 0)
  SetCamera(26.888, 1.52, -9.262, 0, 40, "LINEAR", 0, false, 0)
  SetCameraTarget(27.583, 1.045, -9.681, "LINEAR", 0, false, 0)
  MessageTalk("m020_130_090")
  PlayMotion("PIYOMON_01", "bn01", 5, true, 0)
  PlayMotion("PIYOMON_01", "fq02", 0, false, 15)
  PlayMotion("PIYOMON_01", "bn01", 0, true, 65)
  BlendFaceDigi("PIYOMON_01", 27, 0, 0, "LINEAR", 45, 100)
  MessageTalk("m020_130_100")
  MessageClose()
  SetMouth("PIYOMON_01", 1, 0, 0)
  WaitFrame(40)
  CUT("4.0")
  correct = false
  while not Vista.IsSkipping() and not correct do
    SetEnv_All("c4.0", 0)
    ModelVisible("HERO_01", true, 0, 0)
    SetCamera(29.947, 0.458, -7.744, 0, 20, "LINEAR", 0, false, 0)
    SetCameraTarget(27.107, 0.922, -10.337, "LINEAR", 0, false, 0)
    BlendFaceDigi("PIYOMON_01", -14, 0, 0, "LINEAR", 0, 0)
    BlendFaceDigi("PIYOMON_01", -14, 0, 0, "LINEAR", 0, 0)
    MessageTalkSel(3, "m020_130_110")
    result = Talk.GetResultSelectedNum()
    if result == RESULT_TALK00 then
      SetFace("HERO_01", "F01", 0, 1, FACE_BLENDTIME, 0)
      SetMouth("HERO_01", 0, 6, 0)
      SetMouth("HERO_01", 1, 0, 60)
      PlayMotionForce("HERO_01", "e034", 5, true, 0)
      WaitFrame(90)
      BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
      CUT("4.0_A1")
      SetEnv_All("c4.0_A1", 0)
      SetCamera(27.075, 1.379, -9.066, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(28.22, 0.707, -9.675, "LINEAR", 0, false, 0)
      WaitFrame(5)
      PlayMotion("PIYOMON_01", "fe01", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      MessageTalk("m020_130_120")
      MessageClose()
      WaitFrame(10)
      BlendFaceDigi("PIYOMON_01", 27, 0, 0, "LINEAR", 45, 0)
      MessageTalk("m020_130_130")
      MessageClose()
      WaitFrame(10)
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      BlendFaceDigi("PIYOMON_01", -25, 0, 0, "LINEAR", 20, 0)
      MessageTalk("m020_130_140")
      MessageClose()
      WaitFrame(10)
      MessageTalk("m020_130_145")
      MessageClose()
      WaitFrame(10)
      PlayMotion("PIYOMON_01", "fq01", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      MessageTalk("m020_130_150")
      MessageClose()
      WaitFrame(10)
      correct = true
    elseif result == RESULT_TALK01 then
      PlayMotionBlend("HERO_01", "blend01", 3, false, 0)
      SetMouth("HERO_01", 0, 6, 0)
      SetMouth("HERO_01", 1, 0, 50)
      WaitFrame(80)
      BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
      CUT("4.0_B1")
      SetEnv_All("c4.0_B1", 0)
      ModelVisible("HERO_01", false, 0, 0)
      SetCamera(27.031, 1.425, -8.945, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(28.22, 0.663, -9.627, "LINEAR", 0, false, 0)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      WaitFrame(5)
      MessageTalk("m020_130_160")
      MessageClose()
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      MessageTalk("m020_130_170")
      MessageClose()
      PlayMotion("PIYOMON_01", "fq01", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      SetMouth("PIYOMON_01", 1, 10, 90)
      MessageTalk("m020_130_180")
      MessageClose()
      WaitFrame(10)
    elseif result == RESULT_TALK02 then
      PlayMotionBlend("HERO_01", "blend03", 3, false, 0)
      SetMouth("HERO_01", 0, 6, 0)
      SetMouth("HERO_01", 1, 0, 50)
      WaitFrame(80)
      BlendFace("HERO_01", 0, 0, 0, false, "SCURVE", 0, 0)
      CUT("4.0_C1")
      SetEnv_All("c4.0_C1", 0)
      SetCamera(27.031, 1.425, -8.945, 0, 30, "LINEAR", 0, false, 0)
      SetCameraTarget(28.22, 0.663, -9.627, "LINEAR", 0, false, 0)
      ModelVisible("HERO_01", false, 0, 0)
      WaitFrame(5)
      PlayMotion("PIYOMON_01", "fq02", 5, false, 0)
      PlayMotion("PIYOMON_01", "bn01", 2, true, 50)
      SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
      MessageTalk("m020_130_190")
      MessageClose()
      WaitFrame(10)
    end
  end
  SetFace("PIYOMON_01", "F01_M01", 0, 1, 0, 0)
  Vista.SetKeepBGM()
  if Debug.IsEventView() then
    EVENT_END()
  else
    EVENT_END_SEAMLESS(60)
  end
end

function CUT(cut_no)
  CUT_START(cut_no)
end

function main()
  m020_130()
end
