S050_041 = {
  ID = 41,
  STEP_001 = 1,
  STEP_004 = 4,
  STEP_005 = 5,
  STEP_010 = 10,
  STEP_255 = 255
}
local base = "s050_041_"
local text_file = "s050_041"

function S050_041:Event_010()
  local haguru_index = GetIndex(NPC, "s050_041_haguru")
  Field.ObjectLoadMotion(NPC, haguru_index, "bn01")
  Field.ObjectLoadMotion(NPC, haguru_index, "bn02")
  Field.ObjectLoadMotion(NPC, haguru_index, "bd03")
  Field.ObjectLoadMotion(NPC, haguru_index, "br01")
  Field.ObjectLoadMotion(NPC, haguru_index, "fq01")
  Field.ObjectLoadMotion(NPC, haguru_index, "fq02")
  Field.ObjectLoadMotion(PLAYER, 1, "e002")
  Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
  Field.ObjectLoadMotion(PLAYER, 1, "e008")
  Field.ObjectLoadMotion(PLAYER, 1, "e012")
  HideMinimap(true)
  HideGuide(true)
  if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_004) and not Flg.Check("FLAG_SUB_S050_041_004") then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0010")
    local result = tlk:Select(3, base .. "0020")
    Obj:new(NPC, "s050_041_haguru"):SetRotationYToPlayerAndAnimRun(30)
    WaitFrame(30)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
    if result == RESULT_TALK00 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0030")
    end
    if result == RESULT_TALK01 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0040")
    end
    if result == RESULT_TALK02 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0050")
    end
    tlk:Message(base .. "0060")
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq02", 10, 10)
    tlk:Message(base .. "0070")
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0080")
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    result = tlk:Select(2, base .. "0090")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
      tlk:Message(base .. "0100")
    else
      WaitFrame(15)
      Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq02", 10, 10)
      tlk:Message(base .. "0110")
      tlk:MessageClose()
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      Flg.Set("FLAG_SUB_S050_041_004")
      Qst.Sub:Set(self.ID, self.STEP_004)
      Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
      tlk:EndTalk()
      HideMinimap(false)
      HideGuide(false)
      FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
      goto lbl_730
    end
    Field.ObjectChangeExpression(NPC, haguru_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0250")
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0260")
    Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
    tlk:MessageClose()
    Talk.CloseLetterBox()
    Qst.Sub:Start(self.ID, 1, false)
    Flg.Set("FLAG_SUB_S050_041_001")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Talk.OpenLetterBox()
    tlk:EndTalk()
    Qst.Sub:Set(self.ID, self.STEP_004)
    HideMinimap(false)
    HideGuide(false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_005)
  elseif Qst.Sub:Check(self.ID, self.STEP_004, self.STEP_005) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    Obj:new(NPC, "s050_041_haguru"):SetRotationYToPlayerAndAnimRun(30)
    tlk:Message(base .. "0120")
    result = tlk:Select(2, base .. "0090")
    if result == RESULT_TALK00 then
      Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
      tlk:Message(base .. "0100")
    else
      Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
      Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq02", 10, 10)
      tlk:Message(base .. "0110")
      tlk:MessageClose()
      Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
      Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
      tlk:EndTalk()
      HideMinimap(false)
      HideGuide(false)
      FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
      goto lbl_730
    end
    Field.ObjectChangeExpression(NPC, haguru_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0250")
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0260")
    Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
    tlk:MessageClose()
    Talk.CloseLetterBox()
    Qst.Sub:Start(self.ID, 1, false)
    Flg.Set("FLAG_SUB_S050_041_001")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Talk.OpenLetterBox()
    tlk:EndTalk()
    HideMinimap(false)
    HideGuide(false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_005)
  elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
    local tlk = Tlk:new(text_file, 1, true)
    HideMinimap(true)
    HideGuide(true)
    tlk:StartTalkAndCancelDigimonRide()
    Obj:new(NPC, "s050_041_haguru"):SetRotationYToPlayerAndAnimRun(30)
    Field.ObjectChangeExpression(NPC, haguru_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0250")
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0260")
    Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
    HideMinimap(false)
    HideGuide(false)
    tlk:EndTalk()
  end
  ::lbl_730::
end

function S050_041:Event_020()
  local haguru_index = GetIndex(NPC, "sub_050_041_haguru")
  Field.ObjectLoadMotion(NPC, haguru_index, "bn01")
  Field.ObjectLoadMotion(NPC, haguru_index, "bn02")
  Field.ObjectLoadMotion(NPC, haguru_index, "bd03")
  Field.ObjectLoadMotion(NPC, haguru_index, "br01")
  Field.ObjectLoadMotion(NPC, haguru_index, "fe02")
  Field.ObjectLoadMotion(NPC, haguru_index, "fe04")
  Field.ObjectLoadMotion(NPC, haguru_index, "fq01")
  Field.ObjectLoadMotion(NPC, haguru_index, "fq02")
  Field.ObjectLoadMotion(PLAYER, 1, "e002")
  Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
  Field.ObjectLoadMotion(PLAYER, 1, "e008")
  Field.ObjectLoadMotion(PLAYER, 1, "e012")
  HideMinimap(true)
  HideGuide(true)
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "0130")
    local result = tlk:Select(3, base .. "0140")
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "bd03", 10, 10)
    WaitFrame(30)
    Obj:new(NPC, "sub_050_041_haguru"):SetRotationYToPlayer(30)
    WaitFrame(30)
    if result == RESULT_TALK00 then
      WaitFrame(15)
      tlk:Message(base .. "0150")
    end
    if result == RESULT_TALK01 then
      WaitFrame(15)
      tlk:Message(base .. "0160")
    end
    if result == RESULT_TALK02 then
      WaitFrame(15)
      tlk:Message(base .. "0170")
    end
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
    tlk:Message(base .. "0180")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fe04", 10, 10)
    tlk:Message(base .. "0190")
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0200")
    tlk:MessageClose()
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    tlk:EndTalk()
    Flg.Set("FLAG_SUB_S050_041_002")
    HideMinimap(false)
    HideGuide(false)
    FieldObjectSync(NPC, false)
    WaitFrame(25)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_010)
  end
end

function S050_041:Event_025()
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_255) then
    local solar_index = GetIndex(NPC, "sub_050_041_solar")
    Field.ObjectLoadMotion(NPC, solar_index, "bn01")
    Field.ObjectLoadMotion(NPC, solar_index, "bn02")
    Field.ObjectLoadMotion(NPC, solar_index, "bd03")
    Field.ObjectLoadMotion(NPC, solar_index, "br01")
    Field.ObjectLoadMotion(NPC, solar_index, "fe02")
    Field.ObjectLoadMotion(NPC, solar_index, "fe04")
    Field.ObjectLoadMotion(NPC, solar_index, "fq01")
    Field.ObjectLoadMotion(NPC, solar_index, "fq02")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    HideMinimap(true)
    HideGuide(true)
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    Field.ObjectChangeExpression(NPC, solar_index, "F01", EYES_BLINK_TYPE_CLOSE, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0270")
    local result = tlk:Select(3, base .. "0271")
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, solar_index, "bd03", 10, 10)
    WaitFrame(30)
    Obj:new(NPC, "sub_050_041_solar"):SetRotationYToPlayer(30)
    WaitFrame(30)
    if result == RESULT_TALK00 then
      Field.ObjectChangeExpression(NPC, solar_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0280")
    end
    if result == RESULT_TALK01 then
      Field.ObjectChangeExpression(NPC, solar_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0290")
    end
    if result == RESULT_TALK02 then
      Field.ObjectChangeExpression(NPC, solar_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
      tlk:Message(base .. "0300")
    end
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, solar_index, "fq02", 10, 10)
    Field.ObjectChangeExpression(NPC, solar_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    tlk:Message(base .. "0310")
    tlk:Message(base .. "0320")
    Field.ObjectChangeExpression(NPC, solar_index, "F03", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, solar_index, "fe04", 10, 10)
    tlk:Message(base .. "0330")
    tlk:MessageClose()
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Flg.Set("FLAG_SUB_S050_041_003")
    tlk:EndTalk()
    HideMinimap(false)
    HideGuide(false)
    FieldObjectSync(NPC, false)
    WaitFrame(25)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
  end
end

function S050_041:Event_027()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    BackFadeOutWithWait(FADE_BLACK, 15)
    WaitFrame(30)
    tlk:Message(base .. "0400")
    tlk:EndTalk()
    BackFadeInWithWait(FADE_BLACK, 0)
    MapChange("d", 202, "start_25", true, FADE_BLACK, 0)
  end
end

function S050_041:Event_030()
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_255) then
    local haguru_index = GetIndex(NPC, "s050_041_haguru")
    Field.ObjectLoadMotion(NPC, haguru_index, "bn01")
    Field.ObjectLoadMotion(NPC, haguru_index, "bn02")
    Field.ObjectLoadMotion(NPC, haguru_index, "bd03")
    Field.ObjectLoadMotion(NPC, haguru_index, "br01")
    Field.ObjectLoadMotion(NPC, haguru_index, "fe02")
    Field.ObjectLoadMotion(NPC, haguru_index, "fq01")
    Field.ObjectLoadMotion(NPC, haguru_index, "fq02")
    Field.ObjectLoadMotion(PLAYER, 1, "e002")
    Field.ObjectLoadMotion(PLAYER, 1, "e004_01")
    Field.ObjectLoadMotion(PLAYER, 1, "e008")
    Field.ObjectLoadMotion(PLAYER, 1, "e012")
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    Obj:new(NPC, "s050_041_haguru"):SetRotationYToPlayerAndAnimRun(30)
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
    tlk:Message(base .. "0210")
    Field.ObjectChangeExpression(NPC, haguru_index, "F01", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fq01", 10, 10)
    tlk:Message(base .. "0220")
    Field.ObjectChangeExpression(NPC, haguru_index, "F02", EYES_BLINK_TYPE_BLINK, false, 30, AUTO_CANCEL_NONE, 15)
    Field.ObjectPlayMotionWithStartMoveMotion(NPC, haguru_index, "fe02", 10, 10)
    tlk:Message(base .. "0230")
    Field.ObjectResetMotion(NPC, GetIndex(NPC, "s050_041_haguru"), 30)
    tlk:MessageClose()
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    tlk:EndTalk()
    Flg.Set("FLAG_SUB_S050_041_003")
    Flg.Set("FLAG_IS_CLEAR_S050_041")
    FieldObjectSync(NPC, false)
    WaitFrame(25)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:End(self.ID, self.STEP_255)
  end
end

function S050_041:Event_035()
  if Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_255) or Qst.Sub:IsCompleted(41) then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "0340")
    tlk:Message(base .. "0350")
    tlk:Message(base .. "0360")
    tlk:EndTalk()
  end
end
