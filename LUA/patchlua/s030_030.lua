S030_030 = {
  ID = 30,
  STEP_001 = 1,
  STEP_003 = 3,
  STEP_005 = 5,
  STEP_010 = 10,
  STEP_020 = 20,
  STEP_255 = 255
}
local base = "s030_030_"
local text_file = "s030_030"

function S030_030:Event_010()
  local peck = Obj:new(NPC, "sub030_001")
  local bn01 = Motion.Object:new(NPC, "sub030_001", "bn01")
  local fe02 = Motion.Object:new(NPC, "sub030_001", "fe02")
  local fe04 = Motion.Object:new(NPC, "sub030_001", "fe04")
  local fq01 = Motion.Object:new(NPC, "sub030_001", "fq01")
  local fq02 = Motion.Object:new(NPC, "sub030_001", "fq02")
  local p_e002 = Motion.Object:new(PLAYER, "", "e002")
  local p_e012 = Motion.Object:new(PLAYER, "", "e012")
  local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
  HideMinimap(true)
  HideGuide(true)
  if Flg.Check("FLAG_IS_CLEAR_S030_030") then
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkActionAndZoom("sub030_001")
    peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
    fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "470")
    tlk:EndTalkActionAndZoom()
    peck:ChangeExpression("F01", EYE_BLINK, false, 10)
  elseif Flg.Check("FLAG_IS_CLEAR_S030_024") then
    if Qst.Sub:Check(self.ID, self.STEP_020, self.STEP_255) then
      local tlk = Tlk:new(text_file, 1, true)
      tlk:StartTalkActionAndZoom("sub030_001")
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "440")
      fe04:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "450")
      peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
      tlk:Message(base .. "460")
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "470")
      peck:ChangeExpression("F01", EYE_BLINK, false, 10)
      tlk:EndTalkActionAndZoom()
      Flg.Set("FLAG_IS_CLEAR_S030_030")
      Qst.Sub:End(self.ID, self.STEP_255)
    elseif Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
      local tlk = Tlk:new(text_file, 1, true)
      tlk:StartTalkActionAndZoom("sub030_001")
      peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
      tlk:Message(base .. "150")
      peck:ChangeExpression("F01", EYE_BLINK, false, 10)
      tlk:EndTalkActionAndZoom()
    elseif Qst.Sub:Check(self.ID, self.STEP_003, self.STEP_005) then
      local tlk = Tlk:new(text_file, 1, true)
      tlk:StartTalkActionAndZoom("sub030_001")
      peck:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "110")
      peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "120")
      fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "130")
      peck:ChangeExpression("F03_T01", EYE_BLINK, false, 10)
      tlk:MessageClose()
      local result1 = tlk:Select(2, base .. "140")
      if result1 == RESULT_TALK00 then
        WaitFrame(15)
        peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
        fq01:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "150")
        peck:ChangeExpression("F01", EYE_BLINK, false, 10)
        tlk:EndTalkActionAndZoom()
        Qst.Sub:Set(self.ID, self.STEP_005)
        Flg.Set("FLAG_SUB_030_030_001")
        Qst.Sub:Start(self.ID, 1, false)
      else
        WaitFrame(15)
        peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
        fq02:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "160")
        peck:ChangeExpression("F01", EYE_BLINK, false, 10)
        tlk:EndTalkActionAndZoom()
      end
    elseif Qst.Sub:Check(self.ID, self.STEP_001, self.STEP_005) then
      local tlk = Tlk:new(text_file, 1, true)
      tlk:StartTalkActionAndZoom("sub030_001")
      WaitFrame(30)
      peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "010")
      peck:ChangeExpression("F01_T01", EYE_BLINK, true, 10)
      tlk:Message(base .. "020")
      peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
      tlk:Message(base .. "030")
      peck:ChangeExpression("F01_T01", EYE_BLINK, false, 10)
      tlk:MessageClose()
      local result = tlk:Select(3, base .. "040")
      if result == RESULT_TALK00 then
        WaitFrame(15)
        fq02:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "050")
        fq01:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "060")
      elseif result == RESULT_TALK01 then
        WaitFrame(15)
        fq02:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "070")
        peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
        fe04:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "080")
        peck:ChangeExpression("F01_T01", EYE_BLINK, false, 10)
      else
        peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
        fq02:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "090")
        fe04:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "100")
        peck:ChangeExpression("F01_T01", EYE_BLINK, false, 10)
      end
      peck:ChangeExpression("F01_T01", EYE_CLOSE, true, 10)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "110")
      peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "120")
      fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "130")
      peck:ChangeExpression("F03_T01", EYE_BLINK, false, 10)
      tlk:MessageClose()
      local result1 = tlk:Select(2, base .. "140")
      if result1 == RESULT_TALK00 then
        WaitFrame(15)
        peck:ChangeExpression("F02_T01", EYE_BLINK, true, 10)
        fq01:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "150")
        peck:ChangeExpression("F01_T01", EYE_BLINK, false, 10)
        tlk:EndTalkActionAndZoom()
        Qst.Sub:Set(self.ID, self.STEP_003)
        Qst.Sub:Set(self.ID, self.STEP_005)
        Flg.Set("FLAG_SUB_030_030_001")
        Qst.Sub:Start(self.ID, 1, false)
      else
        WaitFrame(15)
        peck:ChangeExpression("F03_T01", EYE_BLINK, true, 10)
        fq02:PlayWithStartMoveMotion(10, 10)
        tlk:Message(base .. "160")
        peck:ChangeExpression("F01_T01", EYE_BLINK, false, 10)
        tlk:EndTalkActionAndZoom()
        Qst.Sub:Set(self.ID, self.STEP_003)
      end
    end
  end
  HideMinimap(false)
  HideGuide(false)
end

function S030_030:Event_020()
  local bn01 = Motion.Object:new(NPC, "sub030_001", "bn01")
  local fq01 = Motion.Object:new(NPC, "sub030_001", "fq01")
  local fq02 = Motion.Object:new(NPC, "sub030_001", "fq02")
  local fe02 = Motion.Object:new(NPC, "sub030_001", "fe02")
  local fe04 = Motion.Object:new(NPC, "sub030_001", "fe04")
  local p_e012 = Motion.Object:new(PLAYER, "", "e012")
  local p_e018 = Motion.Object:new(PLAYER, "", "e018")
  local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
  if Qst.Sub:Check(self.ID, self.STEP_005, self.STEP_010) then
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    p_fn01_01:Play(15, true)
    HideMinimap(true)
    HideGuide(true)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Field_InvisibleFollowerAllGuest(0, 0, false)
    Obj:new(PLAYER, ""):SetPos(14.269, -5.618, -25.67)
    Obj:new(PLAYER, ""):SetRotationY(0, 0)
    Cam.Inst:Set(13.08, -3.353, -32.716, 16.077, -5.427, -23.404, default, 0)
    WaitFrame(30)
    FadeAllInWithWait(FADE_BLACK, FADE_TIME)
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "170")
    fq02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "180")
    fe02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "190")
    tlk:MessageClose()
    local result = tlk:Select(3, base .. "200")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "210")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "220")
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "230")
    else
      WaitFrame(15)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "240")
      fe02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "250")
    end
    fe04:PlayWithStartMoveMotion(10, 10)
    p_e018:Play(10, false)
    tlk:Message(base .. "260")
    tlk:EndTalk(true)
    Qst.Sub:Set(self.ID, self.STEP_010)
    EncountFromField_WithNormalEffect(20300300, 10474, false)
  end
  HideMinimap(false)
  HideGuide(false)
end

function S030_030:Event_030()
  local bn01 = Motion.Object:new(NPC, "sub030_001", "bn01")
  local fq01 = Motion.Object:new(NPC, "sub030_001", "fq01")
  local fq02 = Motion.Object:new(NPC, "sub030_001", "fq02")
  local p_e002 = Motion.Object:new(PLAYER, "", "e002")
  local p_e004 = Motion.Object:new(PLAYER, "", "e004")
  local p_e012 = Motion.Object:new(PLAYER, "", "e012")
  local p_fn01_01 = Motion.Object:new(PLAYER, "", "fn01_01")
  if Qst.Sub:Check(self.ID, self.STEP_010, self.STEP_020) and Flg.Check("FLAG_SUB_030_030_010") and Flg.Check("FLAG_SUB_030_030_010") then
    fq02:PlayWithStartMoveMotion(10, 10)
    p_fn01_01:PlayWithStartMoveMotion(10, 10)
    FieldObjectSync(NPC, true)
    HideMinimap(true)
    HideGuide(true)
    Cam.Inst:Set(13.08, -3.353, -32.716, 16.077, -5.427, -23.404, default, 0)
    Field_InvisibleFollowerAllPartyMember(0, 0, false)
    Field_InvisibleFollowerAllGuest(0, 0, false)
    WaitFrame(60)
    FadeAllInWithWait(FADE_WHITE, FADE_TIME)
    local tlk = Tlk:new(text_file, 1, true)
    tlk:StartTalkAndCancelDigimonRide()
    tlk:Message(base .. "270")
    fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "280")
    tlk:MessageClose()
    local result = tlk:Select(3, base .. "290")
    if result == RESULT_TALK00 then
      WaitFrame(15)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "300")
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "310")
    elseif result == RESULT_TALK01 then
      WaitFrame(15)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "320")
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "330")
    else
      WaitFrame(15)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "340")
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "350")
    end
    fq01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "360")
    tlk:Message(base .. "370")
    fq02:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "380")
    tlk:MessageClose()
    local result1 = tlk:Select(3, base .. "390")
    if result1 == RESULT_TALK00 then
      WaitFrame(15)
      tlk:Message(base .. "400")
    elseif result1 == RESULT_TALK01 then
      WaitFrame(15)
      fq01:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "410")
    else
      WaitFrame(15)
      fq02:PlayWithStartMoveMotion(10, 10)
      tlk:Message(base .. "420")
    end
    bn01:PlayWithStartMoveMotion(10, 10)
    tlk:Message(base .. "430")
    tlk:EndTalk()
    Flg.Set("FLAG_SUB_030_030_002")
    Fade_OutNoLoadingWithWait(FADE_BLACK, FADE_TIME)
    Cam.Inst:Clear(0)
    FieldObjectSync(FOR_ALL, false)
    WaitFrame(30)
    HideMinimap(false)
    HideGuide(false)
    FadeInWithWaitNotFlgCheck(FADE_BLACK, FADE_TIME)
    Qst.Sub:Set(self.ID, self.STEP_020)
  end
end

function S030_030:Event_040()
  local bn01 = Motion.Object:new(NPC, "sub030_002", "bn01")
  local fq01 = Motion.Object:new(NPC, "sub030_002", "fq01")
  local tlk = Tlk:new(text_file, 1, true)
  tlk:StartTalkActionAndZoom("sub030_002")
  fq01:PlayWithStartMoveMotion(10, 10)
  tlk:Message(base .. "480")
  tlk:EndTalkActionAndZoom()
end
